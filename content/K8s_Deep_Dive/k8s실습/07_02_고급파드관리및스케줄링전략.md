---
title: 07_02ì¿ ë²„ë„¤í‹°ìŠ¤ ê³ ê¸‰ íŒŒë“œ ê´€ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§ ì „ëµ
tags:
  - kubernetes
  - pod-management
  - scheduling
  - devops
  - infrastructure
aliases:
  - k8s-pod-advanced
  - íŒŒë“œê´€ë¦¬
  - ì¿ ë²„ë„¤í‹°ìŠ¤ê³ ê¸‰
date: 2025-11-24
category: k8sì‹¤ìŠµ/ì¿ ë²„ë„¤í‹°ìŠ¤
status: ì™„ì„±
priority: ë†’ìŒ
---

# ğŸ¯ ì¿ ë²„ë„¤í‹°ìŠ¤ ê³ ê¸‰ íŒŒë“œ ê´€ë¦¬ ë° ìŠ¤ì¼€ì¤„ë§ ì „ëµ

> [!info] ë¬¸ì„œ ê°œìš”
> ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ íŒŒë“œë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•˜ê³ , ì›í•˜ëŠ” ìœ„ì¹˜ì— íš¨ìœ¨ì ìœ¼ë¡œ ë°°í¬í•˜ê¸° ìœ„í•œ ê³ ê¸‰ ê°œë…ë“¤ì„ ë¹„ì „ê³µì ê´€ì ì—ì„œ ìƒì„¸íˆ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“‘ ëª©ì°¨
- [[#1. Probe (í”„ë¡œë¸Œ): íŒŒë“œì˜ ê±´ê°•ê²€ì§„ ì‹œìŠ¤í…œ|í”„ë¡œë¸Œ ì‹œìŠ¤í…œ]]
- [[#2. Init Container: ì˜í™” ì‹œì‘ ì „ ì˜ˆê³ í¸|Init Container]]
- [[#3. ë©€í‹° ì»¨í…Œì´ë„ˆ íŒ¨í„´: íŒ€ì›Œí¬ì˜ ì˜ˆìˆ |ë©€í‹° ì»¨í…Œì´ë„ˆ íŒ¨í„´]]
- [[#4. Pod Affinity: íŒŒë“œë“¤ì˜ ì¸ê°„ê´€ê³„|Pod Affinity]]
- [[#5. Topology Spread Constraints: ì™„ë²½í•œ ê· í˜•|í† í´ë¡œì§€ ë¶„ë°°]]
- [[#ğŸ¯ ì‹¤ì „ ì¡°í•© ì˜ˆì‹œ|ì‹¤ì „ ì˜ˆì‹œ]]

---

## 1. Probe (í”„ë¡œë¸Œ): íŒŒë“œì˜ ê±´ê°•ê²€ì§„ ì‹œìŠ¤í…œ

> [!note] í•µì‹¬ ê°œë…
> ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì»¨í…Œì´ë„ˆì˜ ìƒíƒœë¥¼ ìë™ìœ¼ë¡œ í™•ì¸í•˜ëŠ” **ê±´ê°•ê²€ì§„** ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë§ˆì¹˜ ë³‘ì›ì—ì„œ ì •ê¸°ê²€ì§„ì„ ë°›ëŠ” ê²ƒì²˜ëŸ¼, ì»¨í…Œì´ë„ˆë„ ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬ë¥¼ ë°›ìŠµë‹ˆë‹¤.

### ğŸ’“ Liveness Probe (ìƒì¡´ í™•ì¸)

**ğŸ¤” ì§ˆë¬¸**: "ì´ ì»¨í…Œì´ë„ˆê°€ ì‚´ì•„ìˆë‚˜ìš”?"

#### ğŸ  ì‹¤ìƒí™œ ë¹„ìœ 
```mermaid
graph LR
    A[ì§ì¥ ë™ë£Œê°€ ì‘ë‹µ ì—†ìŒ] --> B[ê¹¨ìš°ê¸° ì‹œë„]
    B --> C[ëŒ€ì‹  ì¼ ì²˜ë¦¬]
    
    D[ì»¨í…Œì´ë„ˆ ì‘ë‹µ ì—†ìŒ] --> E[Liveness Probe ê°ì§€]
    E --> F[ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘]
```

#### ğŸ“‹ êµ¬ì²´ì ì¸ ì‹œë‚˜ë¦¬ì˜¤

> [!example] ì‹¤ì œ ì¥ì•  ìƒí™©
> 1. **ë¬¸ì œ**: ì›¹ì„œë²„ê°€ ë¬´í•œë£¨í”„ì— ë¹ ì ¸ ì‘ë‹µ ë¶ˆê°€ ìƒíƒœ
> 2. **ê°ì§€**: Liveness Probeê°€ `/health` ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ ì‹¤íŒ¨ ê°ì§€
> 3. **ì¡°ì¹˜**: ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
> 4. **ê²°ê³¼**: ì„œë¹„ìŠ¤ ì •ìƒí™”

#### ğŸ’» ì‹¤ì œ ì„¤ì • ì˜ˆì‹œ

```yaml
# ğŸ“Š Liveness Probe ìƒì„¸ ì„¤ì •
livenessProbe:
  httpGet:
    path: /healthz              # ê±´ê°• ìƒíƒœ í™•ì¸ URL
    port: 8080                  # í¬íŠ¸ ë²ˆí˜¸
    httpHeaders:                # ì¶”ê°€ í—¤ë” (ì„ íƒì‚¬í•­)
    - name: Custom-Header
      value: health-check
  initialDelaySeconds: 5        # ì‹œì‘ í›„ 5ì´ˆ ëŒ€ê¸°
  periodSeconds: 10             # 10ì´ˆë§ˆë‹¤ ê²€ì‚¬
  timeoutSeconds: 3             # 3ì´ˆ ì•ˆì— ì‘ë‹µ ì—†ìœ¼ë©´ ì‹¤íŒ¨
  failureThreshold: 3           # 3ë²ˆ ì—°ì† ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œì‘
  successThreshold: 1           # 1ë²ˆ ì„±ê³µí•˜ë©´ ì •ìƒ íŒì •
```

#### ğŸ“Š í”„ë¡œë¸Œ íƒ€ì…ë³„ ë¹„êµ

| íƒ€ì… | ìš©ë„ | ì˜ˆì‹œ |
|------|------|------|
| **httpGet** | HTTP ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ | `GET /health` |
| **tcpSocket** | TCP í¬íŠ¸ ì—°ê²° í™•ì¸ | `í¬íŠ¸ 8080 ì—°ê²°` |
| **exec** | ëª…ë ¹ì–´ ì‹¤í–‰ ê²°ê³¼ í™•ì¸ | `curl localhost:8080` |

### ğŸš¦ Readiness Probe (ì¤€ë¹„ ìƒíƒœ í™•ì¸)

**ğŸ¤” ì§ˆë¬¸**: "ì´ ì»¨í…Œì´ë„ˆê°€ ì¼í•  ì¤€ë¹„ ëë‚˜ìš”?"

#### ğŸ  ì‹¤ìƒí™œ ë¹„ìœ 

```mermaid
graph TD
    A[ì‹ë‹¹ ì˜¤í”ˆ ì „] --> B[ì¬ë£Œ ì¤€ë¹„]
    B --> C[ì²­ì†Œ ì™„ë£Œ]
    C --> D[ì†ë‹˜ ë°›ê¸° ì‹œì‘]
    
    E[ì»¨í…Œì´ë„ˆ ì‹œì‘] --> F[ë°ì´í„° ë¡œë”©]
    F --> G[ì´ˆê¸°í™” ì™„ë£Œ]
    G --> H[íŠ¸ë˜í”½ ë°›ê¸° ì‹œì‘]
```

#### ğŸ“‹ êµ¬ì²´ì ì¸ ì‹œë‚˜ë¦¬ì˜¤

> [!example] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œë‚˜ë¦¬ì˜¤
> 1. **ìƒí™©**: ì›¹ì„œë²„ê°€ ì‹œì‘ë˜ì—ˆì§€ë§Œ DB ì—°ê²°ì€ ì•„ì§ ì§„í–‰ ì¤‘
> 2. **Readiness Probe**: `/ready` ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ â†’ ì‹¤íŒ¨ ì‘ë‹µ
> 3. **ì¿ ë²„ë„¤í‹°ìŠ¤ ì¡°ì¹˜**: ë¡œë“œë°¸ëŸ°ì„œì—ì„œ í•´ë‹¹ íŒŒë“œ ì œì™¸
> 4. **DB ì—°ê²° ì™„ë£Œ**: `/ready` ì—”ë“œí¬ì¸íŠ¸ â†’ ì„±ê³µ ì‘ë‹µ
> 5. **íŠ¸ë˜í”½ ë³µêµ¬**: ë¡œë“œë°¸ëŸ°ì„œì— íŒŒë“œ ë‹¤ì‹œ ì¶”ê°€

#### ğŸ’» ì‹¤ì œ ì„¤ì • ì˜ˆì‹œ

```yaml
# ğŸš¦ Readiness Probe ìƒì„¸ ì„¤ì •
readinessProbe:
  httpGet:
    path: /ready                # ì¤€ë¹„ ìƒíƒœ í™•ì¸ URL
    port: 8080
  initialDelaySeconds: 5        
  periodSeconds: 5              # ë” ìì£¼ í™•ì¸ (5ì´ˆë§ˆë‹¤)
  timeoutSeconds: 2
  failureThreshold: 3           
  successThreshold: 1
```

### ğŸš€ Startup Probe (ì‹œì‘ ì™„ë£Œ í™•ì¸)

**ğŸ¤” ì§ˆë¬¸**: "ì´ ì»¨í…Œì´ë„ˆê°€ ì™„ì „íˆ ì‹œì‘ ëë‚˜ìš”?"

#### ğŸ  ì‹¤ìƒí™œ ë¹„ìœ 

> [!info] ì˜¤ë˜ëœ ì»´í“¨í„° ë¶€íŒ…
> - ì˜¤ë˜ëœ ì»´í“¨í„° ë¶€íŒ… â†’ **5ë¶„ ì†Œìš”** â†’ ê·¸ ë™ì•ˆì€ ê±´ë“œë¦¬ì§€ ë§ê¸°
> - ë ˆê±°ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ â†’ **10ë¶„ ì†Œìš”** â†’ ì™„ì „ ì‹œì‘ í›„ ê±´ê°•ê²€ì§„ ì‹œì‘

#### ğŸš¨ ë¬¸ì œ ìƒí™©ê³¼ í•´ê²°

```mermaid
graph TD
    A[ë¬¸ì œ: ì‹œì‘ì— 5ë¶„ ê±¸ë¦¬ëŠ” ì•±] --> B[Liveness Probe 30ì´ˆë§ˆë‹¤ í™•ì¸]
    B --> C[1ë¶„ í›„ ì‘ë‹µ ì—†ë‹¤ íŒë‹¨]
    C --> D[ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ë°˜ë³µ]
    
    E[í•´ê²°: Startup Probe ì‚¬ìš©] --> F[ì‹œì‘ ì™„ë£Œê¹Œì§€ ê¸°ë‹¤ë¦¼]
    F --> G[ì™„ë£Œ í›„ ì •ìƒì ì¸ ê±´ê°•ê²€ì§„ ì‹œì‘]
```

#### ğŸ’» ì‹¤ì œ ì„¤ì • ì˜ˆì‹œ

```yaml
# ğŸš€ Startup Probe for Legacy Applications
startupProbe:
  tcpSocket:
    port: 8080
  initialDelaySeconds: 10       # 10ì´ˆ í›„ ì‹œì‘
  periodSeconds: 10             # 10ì´ˆë§ˆë‹¤ í™•ì¸
  failureThreshold: 30          # 30ë²ˆ ì‹¤íŒ¨ê¹Œì§€ í—ˆìš© (ì´ 5ë¶„)
  timeoutSeconds: 5
```

> [!warning] ì£¼ì˜ì‚¬í•­
> - Startup Probeê°€ ì„±ê³µí•  ë•Œê¹Œì§€ Liveness/Readiness ProbeëŠ” **ë¹„í™œì„±í™”**ë©ë‹ˆë‹¤.
> - ë„ˆë¬´ ê´€ëŒ€í•œ ì„¤ì •ì€ ì‹¤ì œ ì¥ì• ë¥¼ ë†“ì¹  ìˆ˜ ìˆìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”.

---

## 2. Init Container: ì˜í™” ì‹œì‘ ì „ ì˜ˆê³ í¸

> [!note] í•µì‹¬ ê°œë…
> ë©”ì¸ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ê¸° **ì „ì—** ë°˜ë“œì‹œ í•´ì•¼ í•  ì¼ë“¤ì„ ë‹´ë‹¹í•˜ëŠ” ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤.

### ğŸ­ ì‹¤ìƒí™œ ë¹„ìœ 

```mermaid
graph LR
    A[ì˜í™”ê´€: ì˜ˆê³ í¸] --> B[ë©”ì¸ ì˜í™” ìƒì˜]
    C[ì‹ë‹¹: ì¬ë£Œ ì¤€ë¹„] --> D[ìš”ë¦¬ ì‹œì‘]
    E[ì½˜ì„œíŠ¸: ë¬´ëŒ€ ì…‹íŒ…] --> F[ê³µì—° ì‹œì‘]
    G[Init Container] --> H[Main Container]
```

### ğŸ“‹ ì£¼ìš” íŠ¹ì§•

| íŠ¹ì§• | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ìˆœì°¨ ì‹¤í–‰** | ì •ì˜ëœ ìˆœì„œëŒ€ë¡œ í•˜ë‚˜ì”© ì‹¤í–‰ | DB ë§ˆì´ê·¸ë ˆì´ì…˜ â†’ ë°ì´í„° ì‹œë”© |
| **ì™„ë£Œ í•„ìˆ˜** | ëª¨ë“  Init Container ì„±ê³µ í•„ìš” | í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ë©”ì¸ ì•± ì‹œì‘ ì•ˆ ë¨ |
| **ì¼íšŒì„±** | í•œ ë²ˆ ì‹¤í–‰ í›„ ì¢…ë£Œ | ì„¤ì • íŒŒì¼ ë‹¤ìš´ë¡œë“œ |

### ğŸ”§ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

#### ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ 1: ë°ì´í„°ë² ì´ìŠ¤ ì¤€ë¹„

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app-with-db-setup
spec:
  # ğŸ¬ Init Containers (ìˆœì„œëŒ€ë¡œ ì‹¤í–‰)
  initContainers:
  - name: db-migration            # 1ë‹¨ê³„: ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸
    image: migrate:latest
    command: 
    - /bin/sh
    - -c
    - |
      echo "ğŸ”„ Starting database migration..."
      migrate -database $DATABASE_URL up
      echo "âœ… Database migration completed!"
    env:
    - name: DATABASE_URL
      value: "postgres://user:pass@db:5432/myapp"
    
  - name: seed-data              # 2ë‹¨ê³„: ê¸°ì´ˆ ë°ì´í„° ì…ë ¥  
    image: seeder:latest
    command:
    - /bin/sh
    - -c  
    - |
      echo "ğŸŒ± Seeding initial data..."
      ./seed-script.sh
      echo "âœ… Data seeding completed!"
      
  # ğŸš€ Main Application
  containers:
  - name: web-app               # 3ë‹¨ê³„: ì›¹ì•± ì‹¤í–‰
    image: my-web-app:latest
    ports:
    - containerPort: 8080
```

#### ğŸ”— ì‹œë‚˜ë¦¬ì˜¤ 2: ì„¤ì • íŒŒì¼ ë‹¤ìš´ë¡œë“œ

```yaml
spec:
  # ğŸ“ ê³µìœ  ë³¼ë¥¨ ì •ì˜
  volumes:
  - name: config-volume
    emptyDir: {}
    
  initContainers:
  - name: config-downloader
    image: alpine/curl:latest
    command:
    - /bin/sh
    - -c
    - |
      echo "ğŸ“¥ Downloading configuration..."
      curl -o /config/app-config.json \
        https://config-server.company.com/prod/app-config.json
      
      curl -o /config/database.yaml \
        https://config-server.company.com/prod/database.yaml
        
      echo "âœ… Configuration files downloaded!"
      ls -la /config/
    volumeMounts:
    - name: config-volume
      mountPath: /config
      
  containers:
  - name: main-app
    image: my-app:latest
    volumeMounts:
    - name: config-volume          # ë‹¤ìš´ë¡œë“œëœ ì„¤ì • ì‚¬ìš©
      mountPath: /app/config
      readOnly: true
```

#### ğŸ” ì‹œë‚˜ë¦¬ì˜¤ 3: ë³´ì•ˆ ì„¤ì • ë° ê¶Œí•œ ì²´í¬

```yaml
spec:
  initContainers:
  - name: security-setup
    image: busybox:latest
    securityContext:
      runAsUser: 0                 # root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
    command:
    - /bin/sh
    - -c
    - |
      echo "ğŸ” Setting up security..."
      
      # ë””ë ‰í† ë¦¬ ê¶Œí•œ ì„¤ì •
      mkdir -p /app/data /app/logs
      chmod 755 /app/data
      chmod 777 /app/logs
      
      # ì‚¬ìš©ì ê³„ì • ìƒì„±
      adduser -D -u 1001 appuser
      chown -R appuser:appuser /app
      
      echo "âœ… Security setup completed!"
    volumeMounts:
    - name: app-volume
      mountPath: /app
      
  containers:
  - name: main-app
    image: my-secure-app:latest
    securityContext:
      runAsUser: 1001              # ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰
```

### ğŸ“ˆ Init Container ëª¨ë‹ˆí„°ë§

> [!tip] ë””ë²„ê¹… íŒ
> ```bash
> # Init Container ìƒíƒœ í™•ì¸
> kubectl describe pod <pod-name>
> 
> # Init Container ë¡œê·¸ í™•ì¸  
> kubectl logs <pod-name> -c <init-container-name>
> 
> # ì‹¤í–‰ ì¤‘ì¸ Init Container ì ‘ì†
> kubectl exec -it <pod-name> -c <init-container-name> -- /bin/sh
> ```

---

## 3. ë©€í‹° ì»¨í…Œì´ë„ˆ íŒ¨í„´: íŒ€ì›Œí¬ì˜ ì˜ˆìˆ 

> [!note] í•µì‹¬ ê°œë…
> í•˜ë‚˜ì˜ íŒŒë“œ ì•ˆì— ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ í•¨ê»˜ ë°°ì¹˜í•˜ì—¬ ê¸°ëŠ¥ì„ í™•ì¥í•˜ê±°ë‚˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë””ìì¸ íŒ¨í„´ë“¤ì…ë‹ˆë‹¤.

### ğŸï¸ Sidecar Pattern (ì‚¬ì´ë“œì¹´ íŒ¨í„´)

> [!info] íŒ¨í„´ ê°œìš”
> **"ë©”ì¸ ì˜¤í† ë°”ì´ ì˜†ì— ë¶™ì€ ì‚¬ì´ë“œì¹´"** ì²˜ëŸ¼, ë©”ì¸ ì»¨í…Œì´ë„ˆì˜ í•µì‹¬ ê¸°ëŠ¥ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

#### ğŸ¯ ì‚¬ìš© ëª©ì 

```mermaid
graph TD
    A[ë©”ì¸ ì•±] --> B[í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§]
    C[ì‚¬ì´ë“œì¹´] --> D[ë¶€ê°€ ê¸°ëŠ¥]
    
    D --> E[ë¡œê·¸ ìˆ˜ì§‘]
    D --> F[ë©”íŠ¸ë¦­ ìˆ˜ì§‘] 
    D --> G[ì„¤ì • ë™ê¸°í™”]
    D --> H[í”„ë¡ì‹œ ì—­í• ]
```

#### ğŸ’» ì‹¤ì œ êµ¬í˜„: ì›¹ì„œë²„ + ë¡œê·¸ ìˆ˜ì§‘ê¸°

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp-with-logging
  labels:
    app: webapp
spec:
  # ğŸ“ ê³µìœ  ë³¼ë¥¨
  volumes:
  - name: shared-logs
    emptyDir: {}
  - name: log-config
    configMap:
      name: fluentd-config
      
  containers:
  # ğŸŒ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  - name: nginx-server
    image: nginx:latest
    ports:
    - containerPort: 80
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx    # ë¡œê·¸ íŒŒì¼ ì €ì¥ ìœ„ì¹˜
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi" 
        cpu: "500m"
        
  # ğŸ“Š ì‚¬ì´ë“œì¹´: ë¡œê·¸ ìˆ˜ì§‘ê¸°
  - name: log-shipper
    image: fluent/fluentd:latest
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx    # ê°™ì€ ë¡œê·¸ ë””ë ‰í† ë¦¬ ì ‘ê·¼
      readOnly: true
    - name: log-config
      mountPath: /fluentd/etc
    env:
    - name: FLUENTD_CONF
      value: "fluentd.conf"
    - name: LOG_DESTINATION
      value: "elasticsearch.logging.svc.cluster.local"
```

#### ğŸ“Š ì‚¬ì´ë“œì¹´ ì„¤ì • íŒŒì¼ (ConfigMap)

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
data:
  fluentd.conf: |
    # ğŸ” Nginx ì•¡ì„¸ìŠ¤ ë¡œê·¸ íŒŒì‹±
    <source>
      @type tail
      path /var/log/nginx/access.log
      pos_file /var/log/fluentd-nginx-access.log.pos
      tag nginx.access
      format nginx
    </source>
    
    # ğŸš¨ ì—ëŸ¬ ë¡œê·¸ íŒŒì‹±  
    <source>
      @type tail
      path /var/log/nginx/error.log
      pos_file /var/log/fluentd-nginx-error.log.pos
      tag nginx.error
      format /^(?<time>[^ ]* [^ ]*) \[(?<level>[^\]]*)?\] (?<message>.*)$/
    </source>
    
    # ğŸ“¤ Elasticsearchë¡œ ì „ì†¡
    <match nginx.**>
      @type elasticsearch
      host "#{ENV['LOG_DESTINATION']}"
      port 9200
      index_name nginx
      type_name _doc
    </match>
```

#### âœ… ì‚¬ì´ë“œì¹´ íŒ¨í„´ì˜ ì¥ì 

| ì¥ì  | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ë¶„ë¦¬ëœ ê´€ì‹¬ì‚¬** | ê° ì»¨í…Œì´ë„ˆê°€ ë‹¨ì¼ ì±…ì„ | ì›¹ì„œë²„ vs ë¡œê·¸ ìˆ˜ì§‘ |
| **ì¬ì‚¬ìš©ì„±** | ë‹¤ë¥¸ ì•±ì—ë„ ê°™ì€ ì‚¬ì´ë“œì¹´ ì‚¬ìš© | ëª¨ë“  ì›¹ì•±ì— ê°™ì€ ë¡œê·¸ ìˆ˜ì§‘ê¸° |
| **ë…ë¦½ì  ì—…ë°ì´íŠ¸** | ë©”ì¸ ì•± ìˆ˜ì • ì—†ì´ ì‚¬ì´ë“œì¹´ ì—…ê·¸ë ˆì´ë“œ | ë¡œê·¸ í˜•ì‹ ë³€ê²½ ì‹œ |
| **ê¸°ìˆ  ë‹¤ì–‘ì„±** | ë‹¤ë¥¸ ì–¸ì–´/ê¸°ìˆ  ìŠ¤íƒ ì‚¬ìš© ê°€ëŠ¥ | Java ì•± + Go ëª¨ë‹ˆí„°ë§ |

### ğŸ¢ Ambassador Pattern (ëŒ€ì‚¬ íŒ¨í„´)

> [!info] íŒ¨í„´ ê°œìš”
> **"ì™¸êµê´€ì´ ë³µì¡í•œ ì™¸êµë¥¼ ëŒ€ì‹  ì²˜ë¦¬"** í•˜ë“¯ì´, ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ëŠ” ë°©ì‹ì„ ë‹¨ìˆœí™”ì‹œì¼œì£¼ëŠ” í”„ë¡ì‹œ ì—­í• ì„ í•©ë‹ˆë‹¤.

#### ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³µì¡ì„± í•´ê²°

```mermaid
graph TD
    A[ë©”ì¸ ì•±] --> B[localhost:3000]
    B --> C[Ambassador ì»¨í…Œì´ë„ˆ]
    C --> D[ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬]
    C --> E[ë¡œë“œ ë°¸ëŸ°ì‹±]  
    C --> F[ì¸ì¦/ì¸ê°€]
    C --> G[ì¬ì‹œë„ ë¡œì§]
    C --> H[ì™¸ë¶€ ì„œë¹„ìŠ¤ë“¤]
```

#### ğŸ’» ì‹¤ì œ êµ¬í˜„: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í”„ë¡ì‹œ

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-with-db-ambassador
spec:
  containers:
  # ğŸ’¼ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  - name: main-app
    image: my-simple-app:latest
    env:
    - name: DB_HOST
      value: "localhost"          # ë‹¨ìˆœí•˜ê²Œ localhost ì‚¬ìš©
    - name: DB_PORT  
      value: "5432"
    - name: DB_NAME
      value: "myapp"
    ports:
    - containerPort: 8080
    
  # ğŸŒ Ambassador: ë°ì´í„°ë² ì´ìŠ¤ í”„ë¡ì‹œ
  - name: db-ambassador
    image: envoyproxy/envoy:latest
    ports:
    - containerPort: 5432         # ë¡œì»¬ DB í¬íŠ¸ë¡œ ìœ„ì¥
    volumeMounts:
    - name: envoy-config
      mountPath: /etc/envoy
    command: 
    - /usr/local/bin/envoy
    - -c
    - /etc/envoy/envoy.yaml
    
  volumes:
  - name: envoy-config
    configMap:
      name: envoy-db-config
```

### ğŸ”Œ Adapter Pattern (ì–´ëŒ‘í„° íŒ¨í„´)

> [!info] íŒ¨í„´ ê°œìš”  
> **"220Vë¥¼ 110Vë¡œ ë³€í™˜í•˜ëŠ” ì–´ëŒ‘í„°"** ì²˜ëŸ¼, ë©”ì¸ ì»¨í…Œì´ë„ˆì˜ ì¶œë ¥ì„ ì™¸ë¶€ ì‹œìŠ¤í…œì´ ìš”êµ¬í•˜ëŠ” í‘œì¤€í™”ëœ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

#### ğŸ“Š ë°ì´í„° í˜•ì‹ ë³€í™˜

```mermaid
graph LR
    A[ë ˆê±°ì‹œ ì•±] --> B[ë¹„í‘œì¤€ ë¡œê·¸]
    B --> C[Adapter ì»¨í…Œì´ë„ˆ]
    C --> D[í‘œì¤€ JSON í˜•ì‹]
    D --> E[ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ]
```

---

## 4. Pod Affinity: íŒŒë“œë“¤ì˜ ì¸ê°„ê´€ê³„

> [!note] í•µì‹¬ ê°œë…
> íŒŒë“œë¥¼ **ë‹¤ë¥¸ íŒŒë“œì™€ì˜ ê´€ê³„**ì— ë”°ë¼ íŠ¹ì • ë…¸ë“œì— í•¨ê»˜ ë°°ì¹˜í•˜ê±°ë‚˜, í˜¹ì€ ë–¨ì–´ëœ¨ë ¤ ë°°ì¹˜í•˜ëŠ” ìŠ¤ì¼€ì¤„ë§ ê·œì¹™ì…ë‹ˆë‹¤.

### ğŸ‘« Pod Affinity (ì¹œêµ¬ ê´€ê³„)

> [!info] "ì¹œí•œ ì¹œêµ¬ì™€ ê°™ì€ ë™ë„¤ì— ì‚´ê³  ì‹¶ì–´!"
> íŠ¹ì • ë¼ë²¨ì„ ê°€ì§„ íŒŒë“œê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì— ìƒˆë¡œìš´ íŒŒë“œë¥¼ í•¨ê»˜ ë°°ì¹˜í•©ë‹ˆë‹¤.

#### ğŸ™ï¸ ì‹¤ìƒí™œ ë¹„ìœ 

```mermaid
graph TD
    A[ì¹´í˜ + ë² ì´ì»¤ë¦¬] --> B[ê°™ì€ ê±´ë¬¼ì— ìˆìœ¼ë©´ ì‹œë„ˆì§€]
    C[ì›¹ì„œë²„ + ìºì‹œì„œë²„] --> D[ê°™ì€ ë…¸ë“œì— ìˆìœ¼ë©´ ì§€ì—° ìµœì†Œí™”]
    E[ì•± + ë°ì´í„°ë² ì´ìŠ¤] --> F[ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™”]
```

#### ğŸ“Š ì„±ëŠ¥ ìµœì í™” ì‹œë‚˜ë¦¬ì˜¤

> [!example] Redis ìºì‹œ ì„œë²„ì™€ì˜ Affinity
> - **ë¬¸ì œ**: ì›¹ì„œë²„ì™€ Redisê°€ ë‹¤ë¥¸ ë…¸ë“œì— ìˆì–´ì„œ ë„¤íŠ¸ì›Œí¬ ì§€ì—° ë°œìƒ
> - **í•´ê²°**: Pod Affinityë¡œ ê°™ì€ ë…¸ë“œì— ë°°ì¹˜
> - **ê²°ê³¼**: ì‘ë‹µì‹œê°„ 50ms â†’ 5msë¡œ ë‹¨ì¶•

#### ğŸ’» ì‹¤ì œ êµ¬í˜„: ì›¹ì„œë²„ + Redis ë°°ì¹˜

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app-with-redis-affinity
spec:
  replicas: 3
  selector:
    matchLabels:
      app: web-app
  template:
    metadata:
      labels:
        app: web-app
        tier: frontend
    spec:
      # ğŸ§² Pod Affinity ì„¤ì •
      affinity:
        podAffinity:
          # ğŸ”¥ í•„ìˆ˜ ì¡°ê±´: ë°˜ë“œì‹œ í•¨ê»˜ ë°°ì¹˜
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: app
                operator: In
                values:
                - redis            # Redis íŒŒë“œì™€ í•¨ê»˜
              - key: role
                operator: In  
                values:
                - cache
            topologyKey: kubernetes.io/hostname  # ê°™ì€ í˜¸ìŠ¤íŠ¸ì—
            
          # ğŸ¯ ì„ í˜¸ ì¡°ê±´: ê°€ëŠ¥í•˜ë©´ í•¨ê»˜ ë°°ì¹˜  
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100            # ìš°ì„ ìˆœìœ„ (1-100)
            podAffinityTerm:
              labelSelector:
                matchLabels:
                  app: monitoring  # ëª¨ë‹ˆí„°ë§ íŒŒë“œì™€ë„ ê°€ëŠ¥í•˜ë©´ í•¨ê»˜
              topologyKey: kubernetes.io/hostname
```

#### ğŸ“ í† í´ë¡œì§€ í‚¤ ì˜µì…˜

| í† í´ë¡œì§€ í‚¤ | ì˜ë¯¸ | ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ |
|-------------|------|---------------|
| `kubernetes.io/hostname` | ê°™ì€ ë…¸ë“œ | ë„¤íŠ¸ì›Œí¬ ì§€ì—° ìµœì†Œí™” |
| `topology.kubernetes.io/zone` | ê°™ì€ ê°€ìš©ì˜ì—­ | ì¤‘ê°„ ìˆ˜ì¤€ ë¶„ì‚° |
| `topology.kubernetes.io/region` | ê°™ì€ ë¦¬ì „ | ì§€ì—­ë³„ ì„œë¹„ìŠ¤ ë¶„ë¦¬ |

### ğŸ‘ Pod Anti-Affinity (ë¼ì´ë²Œ ê´€ê³„)

> [!info] "ê²½ìŸì‚¬ì™€ëŠ” ë‹¤ë¥¸ ë™ë„¤ì— ì‚´ê³  ì‹¶ì–´!"
> íŠ¹ì • ë¼ë²¨ì„ ê°€ì§„ íŒŒë“œê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œë¥¼ í”¼í•´ ë‹¤ë¥¸ ë…¸ë“œì— ë°°ì¹˜í•©ë‹ˆë‹¤.

#### ğŸ¦ ì‹¤ìƒí™œ ë¹„ìœ 

```mermaid
graph TD
    A[ì€í–‰ ì§€ì ë“¤] --> B[ê°™ì€ ì§€ì—­ì— ë„ˆë¬´ ëª°ë¦¬ë©´ ì•ˆ ë¨]
    C[ì›¹ì„œë²„ ë³µì œë³¸ë“¤] --> D[ê°™ì€ ë…¸ë“œì— ë‹¤ ìˆìœ¼ë©´ ë…¸ë“œ ì¥ì•  ì‹œ ì „ì²´ ë‹¤ìš´]
    E[ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤] --> F[ì˜ì¡´ì„± ìµœì†Œí™”ë¥¼ ìœ„í•´ ë¶„ì‚° ë°°ì¹˜]
```

#### ğŸš¨ ê³ ê°€ìš©ì„± í™•ë³´ ì‹œë‚˜ë¦¬ì˜¤

> [!example] ì›¹ì„œë²„ ê³ ê°€ìš©ì„± êµ¬ì„±
> - **ëª©í‘œ**: 3ê°œ ë³µì œë³¸ì„ ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ë°°ì¹˜
> - **íš¨ê³¼**: 1ê°œ ë…¸ë“œ ì¥ì•  ì‹œì—ë„ ì„œë¹„ìŠ¤ ì§€ì†
> - **ê²°ê³¼**: 99.9% â†’ 99.99% ê°€ìš©ì„± í–¥ìƒ

---

## 5. Topology Spread Constraints: ì™„ë²½í•œ ê· í˜•

> [!note] í•µì‹¬ ê°œë…
> íŒŒë“œë“¤ì„ ì—¬ëŸ¬ ì§€ì—­/ë…¸ë“œì— **ìµœëŒ€í•œ ê³ ë¥´ê²Œ** ë¶„ë°°í•˜ëŠ” ê°€ì¥ ì •êµí•˜ê³  ìœ ì—°í•œ ë°©ë²•ì…ë‹ˆë‹¤.

### ğŸ¯ í† í´ë¡œì§€ ë¶„ë°°ì˜ í•„ìš”ì„±

#### ğŸ¢ ì‹¤ìƒí™œ ë¹„ìœ 

```mermaid
graph TD
    A[í”„ëœì°¨ì´ì¦ˆ ë§¤ì¥] --> B[ì„œìš¸ 3ê°œ, ë¶€ì‚° 2ê°œ, ëŒ€êµ¬ 2ê°œ]
    C[íŒŒë“œ ë°°ì¹˜] --> D[Zone A 3ê°œ, Zone B 2ê°œ, Zone C 2ê°œ]
    E[ê³ ë¥¸ ë¶„ë°°] --> F[ì¥ì•  ì‹œ ì˜í–¥ ìµœì†Œí™”]
```

### ğŸšï¸ í•µì‹¬ ê°œë… ìƒì„¸ ë¶„ì„

#### ğŸ“Š maxSkew (ìµœëŒ€ ë¶ˆê· í˜•ë„)

> [!info] "ê° ì§€ì—­ ê°„ íŒŒë“œ ê°œìˆ˜ ì°¨ì´ê°€ ì´ ê°’ ì´í•˜ë¡œ ìœ ì§€ë˜ì–´ì•¼ í•¨"

```mermaid
graph TD
    A["maxSkew: 1"] --> B[Zone A: 3ê°œ íŒŒë“œ]
    A --> C[Zone B: 2ê°œ íŒŒë“œ âœ…]  
    A --> D[Zone C: 4ê°œ íŒŒë“œ âŒ]
    
    E["ì°¨ì´ ê³„ì‚°"] --> F[3-2=1 âœ…]
    E --> G[4-2=2 âŒ]
```

| maxSkew ê°’ | ì˜ë¯¸ | ì˜ˆì‹œ ë°°ì¹˜ |
|-------------|------|-----------|
| **1** | ìµœëŒ€ 1ê°œ ì°¨ì´ | 3-2-2 âœ…, 3-1-2 âŒ |
| **2** | ìµœëŒ€ 2ê°œ ì°¨ì´ | 4-2-2 âœ…, 4-1-2 âŒ |
| **0** | ì™„ì „ ë™ì¼ | 3-3-3 âœ…, 3-2-3 âŒ |

#### ğŸ—ºï¸ topologyKey (ë¶„ë°° ê¸°ì¤€)

| í† í´ë¡œì§€ í‚¤ | ë²”ìœ„ | ì‚¬ìš© ëª©ì  |
|-------------|------|-----------|
| `kubernetes.io/hostname` | ë…¸ë“œë³„ | CPU/ë©”ëª¨ë¦¬ ë¶€í•˜ ë¶„ì‚° |
| `topology.kubernetes.io/zone` | ê°€ìš©ì˜ì—­ë³„ | ë„¤íŠ¸ì›Œí¬/ì „ë ¥ ì¥ì•  ëŒ€ë¹„ |
| `topology.kubernetes.io/region` | ë¦¬ì „ë³„ | ìì—°ì¬í•´/ëŒ€ê·œëª¨ ì¥ì•  ëŒ€ë¹„ |
| `node.kubernetes.io/instance-type` | ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…ë³„ | ì„±ëŠ¥ íŠ¹ì„±ë³„ ë¶„ë°° |

#### ğŸš¦ whenUnsatisfiable (ì œì•½ ìœ„ë°˜ ì‹œ ë™ì‘)

```mermaid
graph TD
    A[ìƒˆ íŒŒë“œ ìŠ¤ì¼€ì¤„ë§ ìš”ì²­] --> B{ì œì•½ ì¡°ê±´ ë§Œì¡± ê°€ëŠ¥?}
    B -->|Yes| C[ì •ìƒ ë°°ì¹˜]
    B -->|No| D{whenUnsatisfiable ì„¤ì •}
    D -->|DoNotSchedule| E[ë°°ì¹˜ ê±°ë¶€]
    D -->|ScheduleAnyway| F[ê°•ì œ ë°°ì¹˜]
```

### ğŸ’» ì‹¤ì œ êµ¬í˜„: ì™„ì „ ë¶„ì‚° ì‹œìŠ¤í…œ

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: distributed-microservice
  labels:
    app: user-service
spec:
  replicas: 9
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
        component: backend
        tier: microservice
    spec:
      # âš–ï¸ í† í´ë¡œì§€ ë¶„ë°° ì œì•½ ì¡°ê±´
      topologySpreadConstraints:
      
      # ğŸ¢ 1ë‹¨ê³„: ì¡´(Zone) ë ˆë²¨ ë¶„ë°°
      - maxSkew: 1                    # ì¡´ ê°„ ìµœëŒ€ 1ê°œ ì°¨ì´
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: DoNotSchedule
        labelSelector:
          matchLabels:
            app: user-service
        minDomains: 3                 # ìµœì†Œ 3ê°œ ì¡´ ì‚¬ìš©
        
      # ğŸ–¥ï¸ 2ë‹¨ê³„: ë…¸ë“œ ë ˆë²¨ ë¶„ë°°  
      - maxSkew: 2                    # ë…¸ë“œ ê°„ ìµœëŒ€ 2ê°œ ì°¨ì´
        topologyKey: kubernetes.io/hostname  
        whenUnsatisfiable: ScheduleAnyway  # ë…¸ë“œ ë¶€ì¡± ì‹œ ê°•ì œ ë°°ì¹˜
        labelSelector:
          matchLabels:
            app: user-service
            
      containers:
      - name: user-service
        image: user-service:v2.1
        ports:
        - containerPort: 8080
        resources:
          requests:
            cpu: 200m
            memory: 256Mi
          limits:
            cpu: 500m
            memory: 512Mi
```

---

## ğŸ¯ ì‹¤ì „ ì¡°í•© ì˜ˆì‹œ: ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ê³ ê°€ìš©ì„± ì›¹ì„œë¹„ìŠ¤

> [!note] ì¢…í•© ì‹œë‚˜ë¦¬ì˜¤
> ëª¨ë“  ê³ ê¸‰ íŒŒë“œ ê´€ë¦¬ ê¸°ë²•ì„ ì¡°í•©í•˜ì—¬ **ì™„ë²½í•œ ê³ ê°€ìš©ì„± ì›¹ì„œë¹„ìŠ¤**ë¥¼ êµ¬ì¶•í•´ë³´ê² ìŠµë‹ˆë‹¤.

### ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

```mermaid
graph TD
    subgraph "ğŸŒ Internet"
        USER[ì‚¬ìš©ì]
    end
    
    subgraph "âš–ï¸ Load Balancer"
        LB[Nginx Ingress]
    end
    
    subgraph "ğŸ–¥ï¸ Kubernetes Cluster"
        subgraph "Zone A"
            WEB1[Web Pod 1]
            CACHE1[Redis 1]
        end
        
        subgraph "Zone B" 
            WEB2[Web Pod 2]
            CACHE2[Redis 2]
        end
        
        subgraph "Zone C"
            WEB3[Web Pod 3] 
            CACHE3[Redis 3]
        end
    end
    
    subgraph "ğŸ’¾ Database"
        DB[(PostgreSQL Cluster)]
    end
    
    USER --> LB
    LB --> WEB1
    LB --> WEB2  
    LB --> WEB3
    WEB1 --> CACHE1
    WEB2 --> CACHE2
    WEB3 --> CACHE3
    WEB1 --> DB
    WEB2 --> DB
    WEB3 --> DB
```

### ğŸ¯ ìµœì¢… ê²°ê³¼

> [!success] ë‹¬ì„±ëœ ëª©í‘œë“¤
> - **ğŸ¥ ê³ ê°€ìš©ì„±**: 99.99% ì—…íƒ€ì„ (3ì¡´ ë¶„ì‚°, ë…¸ë“œ ì¥ì•  ëŒ€ì‘)
> - **ğŸ“Š ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ë° ë¡œê·¸ ìˆ˜ì§‘
> - **ğŸš€ ì„±ëŠ¥**: Redis ì‚¬ì´ë“œì¹´ë¡œ ì‘ë‹µì‹œê°„ ìµœì í™”  
> - **ğŸ”’ ë³´ì•ˆ**: ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
> - **âš¡ í™•ì¥ì„±**: HPA ì—°ë™ ê°€ëŠ¥í•œ êµ¬ì¡°
> - **ğŸ”„ ë¬´ì¤‘ë‹¨ ë°°í¬**: Rolling Update ì „ëµ



## ğŸ“š ì°¸ê³  ìë£Œ

> [!info] ì¶”ê°€ í•™ìŠµ ìë£Œ
> - [Kubernetes ê³µì‹ ë¬¸ì„œ - Pod Lifecycle](https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/)


---
