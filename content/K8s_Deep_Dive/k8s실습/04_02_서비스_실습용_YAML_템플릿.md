# ğŸ› ï¸ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ ì‹¤ìŠµìš© YAML í…œí”Œë¦¿

## ğŸ“‹ ë©”íƒ€ë°ì´í„°
- **ìš©ë„**: ì„œë¹„ìŠ¤ íƒ€ì…ë³„ ì‹¤ìŠµìš© ë¦¬ì†ŒìŠ¤ ì •ì˜
- **í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: âœ… minikube v1.37.0, k8s v1.34.0
- **ê´€ë ¨ ë¬¸ì„œ**: [[04_01_ì¿ ë²„ë„¤í‹°ìŠ¤_ì„œë¹„ìŠ¤_ì‹¤ìŠµ_ê²°ê³¼_ë³´ê³ ì„œ]]

---

## ğŸŒ ExternalName ì„œë¹„ìŠ¤

### 1. MySQL ì™¸ë¶€ ì„œë¹„ìŠ¤ (ì˜ˆì‹œìš©)
```yaml
# external-mysql-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql-external
  namespace: default
spec:
  type: ExternalName
  externalName: db.example.com
  ports:
  - port: 3306
    targetPort: 3306
    protocol: TCP
```

### 2. GitHub API ì™¸ë¶€ ì„œë¹„ìŠ¤ (ì‹¤ì œ ë„ë©”ì¸)
```yaml
# external-github-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: github-api-external
  namespace: default
spec:
  type: ExternalName
  externalName: api.github.com
  ports:
  - port: 443
    targetPort: 443
    protocol: TCP
```

---

## ğŸ  ClusterIP ì„œë¹„ìŠ¤

### 1. ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
```yaml
# backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-app
  labels:
    app: backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: nginx:alpine
        ports:
        - containerPort: 80
        env:
        - name: SERVER_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
```

### 2. ClusterIP ì„œë¹„ìŠ¤
```yaml
# backend-clusterip-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: backend-service
spec:
  type: ClusterIP  # ê¸°ë³¸ê°’ì´ë¯€ë¡œ ìƒëµ ê°€ëŠ¥
  selector:
    app: backend
  ports:
  - name: http
    port: 8080        # ì„œë¹„ìŠ¤ í¬íŠ¸
    targetPort: 80    # ì»¨í…Œì´ë„ˆ í¬íŠ¸
    protocol: TCP
```

---

## ğŸ‘» Headless ì„œë¹„ìŠ¤

### 1. Headless ì„œë¹„ìŠ¤ ì •ì˜
```yaml
# mongodb-headless-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mongodb-headless
  labels:
    app: mongodb
spec:
  clusterIP: None  # Headless ì„œë¹„ìŠ¤ì˜ í•µì‹¬
  selector:
    app: mongodb
  ports:
  - name: mongodb
    port: 27017
    targetPort: 27017
```

### 2. StatefulSet ë°°í¬
```yaml
# mongodb-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mongodb
spec:
  serviceName: mongodb-headless  # Headless ì„œë¹„ìŠ¤ì™€ ì—°ê²°
  replicas: 3
  selector:
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongodb
        image: mongo:5.0
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          value: "admin"
        - name: MONGO_INITDB_ROOT_PASSWORD
          value: "password"
```

### 3. ë¹„êµìš© ClusterIP ì„œë¹„ìŠ¤
```yaml
# mongodb-clusterip-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mongodb-clusterip
spec:
  type: ClusterIP
  selector:
    app: mongodb
  ports:
  - name: mongodb
    port: 27017
    targetPort: 27017
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ìš© íŒŒë“œ

### 1. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ íŒŒë“œ (busybox)
```bash
kubectl run test-pod --image=busybox --restart=Never -- sleep 3600
```

### 2. curl í…ŒìŠ¤íŠ¸ íŒŒë“œ (ì¼íšŒì„±)
```bash
kubectl run test-client --image=curlimages/curl --restart=Never -it --rm -- sh
```

### 3. DNS í…ŒìŠ¤íŠ¸ ì „ìš© íŒŒë“œ
```bash
kubectl run dns-test --image=busybox --restart=Never -- sleep 3600
```

---

## ğŸ“‹ ì‹¤ìŠµ ëª…ë ¹ì–´ ëª¨ìŒ

### ê¸°ë³¸ í™•ì¸ ëª…ë ¹ì–´
```bash
# í´ëŸ¬ìŠ¤í„° ì •ë³´
kubectl cluster-info
kubectl get nodes

# ì„œë¹„ìŠ¤ ëª©ë¡
kubectl get svc
kubectl get svc -o wide

# íŒŒë“œ ìƒíƒœ
kubectl get pods -l app=<label>
kubectl get pods -o wide

# ì—”ë“œí¬ì¸íŠ¸ í™•ì¸  
kubectl get endpoints <service-name>

# ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´
kubectl describe svc <service-name>
```

### DNS í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# ê¸°ë³¸ DNS ì¡°íšŒ
kubectl exec <pod> -- nslookup <service-name>

# FQDN DNS ì¡°íšŒ  
kubectl exec <pod> -- nslookup <service>.default.svc.cluster.local

# ê°œë³„ íŒŒë“œ DNS ì¡°íšŒ (Headless)
kubectl exec <pod> -- nslookup <pod-name>.<service>.default.svc.cluster.local
```

### ì—°ê²° í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# HTTP í…ŒìŠ¤íŠ¸
kubectl exec <pod> -- curl <service>:<port>

# í¬íŠ¸ ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl exec <pod> -- telnet <service> <port>

# ping í…ŒìŠ¤íŠ¸
kubectl exec <pod> -- ping <service>
```

### í¬íŠ¸ í¬ì›Œë”©
```bash
# ì„œë¹„ìŠ¤ í¬íŠ¸ í¬ì›Œë”©
kubectl port-forward svc/<service-name> <local-port>:<service-port>

# íŒŒë“œ í¬íŠ¸ í¬ì›Œë”©  
kubectl port-forward pod/<pod-name> <local-port>:<pod-port>
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ëª…ë ¹ì–´

### DNS ê´€ë ¨ ì´ìŠˆ
```bash
# CoreDNS ìƒíƒœ í™•ì¸
kubectl get pods -n kube-system -l k8s-app=kube-dns

# DNS ì„¤ì • í™•ì¸
kubectl get configmap coredns -n kube-system -o yaml

# íŒŒë“œ ë‚´ DNS ì„¤ì • í™•ì¸
kubectl exec <pod> -- cat /etc/resolv.conf
```

### ì„œë¹„ìŠ¤ ì—°ê²° ì´ìŠˆ
```bash
# ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
kubectl get endpoints <service-name>

# ë¼ë²¨ ì…€ë ‰í„° í™•ì¸
kubectl describe svc <service-name>
kubectl get pods --show-labels

# ë„¤íŠ¸ì›Œí¬ ì •ì±… í™•ì¸
kubectl get networkpolicies
```

### StatefulSet ì´ìŠˆ  
```bash
# StatefulSet ìƒíƒœ
kubectl get statefulset
kubectl describe statefulset <name>

# PVC ìƒíƒœ í™•ì¸
kubectl get pvc

# íŒŒë“œ ì´ë²¤íŠ¸ í™•ì¸
kubectl describe pod <pod-name>
```

---

## ğŸ§¹ í™˜ê²½ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸

### ê°œë³„ ë¦¬ì†ŒìŠ¤ ì •ë¦¬
```bash
# í…ŒìŠ¤íŠ¸ íŒŒë“œ ì •ë¦¬
kubectl delete pod test-pod dns-test test-client --ignore-not-found=true

# ì„œë¹„ìŠ¤ ì •ë¦¬
kubectl delete svc mysql-external github-api-external backend-service mongodb-headless mongodb-clusterip

# ë°°í¬ ì •ë¦¬
kubectl delete deployment backend-app
kubectl delete statefulset mongodb

# PVC ì •ë¦¬ (ì£¼ì˜: ë°ì´í„° ì†ì‹¤)
kubectl delete pvc -l app=mongodb
```

### ì „ì²´ ì •ë¦¬ (ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê¸°ì¤€)
```bash
# í˜„ì¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ì •ë¦¬ (ì£¼ì˜!)
kubectl delete all --all

# íŠ¹ì • ë¼ë²¨ì˜ ë¦¬ì†ŒìŠ¤ë§Œ ì •ë¦¬
kubectl delete all -l app=<label>
```

---

## ğŸ’¡ ì‹¤ìŠµ íŒ

### 1. íŒŒë“œ ìƒíƒœ ëŒ€ê¸°
```bash
# íŒŒë“œ ì¤€ë¹„ ìƒíƒœ ëŒ€ê¸°
kubectl wait --for=condition=ready pod/<pod-name> --timeout=60s
kubectl wait --for=condition=ready pod -l app=<label> --timeout=60s
```

### 2. ë¦¬ì†ŒìŠ¤ ê°ì‹œ
```bash
# ì‹¤ì‹œê°„ ìƒíƒœ ê°ì‹œ
kubectl get pods --watch
kubectl get svc --watch

# ì´ë²¤íŠ¸ í™•ì¸
kubectl get events --sort-by='.lastTimestamp'
```

### 3. ë¡œê·¸ í™•ì¸
```bash
# íŒŒë“œ ë¡œê·¸ í™•ì¸
kubectl logs <pod-name>
kubectl logs -f <pod-name>  # ì‹¤ì‹œê°„

# ì´ì „ ì»¨í…Œì´ë„ˆ ë¡œê·¸ (ì¬ì‹œì‘ëœ ê²½ìš°)
kubectl logs <pod-name> --previous
```

---

## ğŸ“š ì¶”ê°€ í•™ìŠµ ë¦¬ì†ŒìŠ¤

### YAML í…œí”Œë¦¿ í™•ì¥
- [[LoadBalancer ì„œë¹„ìŠ¤ í…œí”Œë¦¿]]
- [[NodePort ì„œë¹„ìŠ¤ í…œí”Œë¦¿]]  
- [[Ingress ë¦¬ì†ŒìŠ¤ í…œí”Œë¦¿]]

### ê³ ê¸‰ ì„¤ì •
- [[NetworkPolicy í…œí”Œë¦¿]]
- [[Service Monitor í…œí”Œë¦¿]]
- [[Pod Security Policy í…œí”Œë¦¿]]

---

*ğŸ·ï¸ íƒœê·¸: #kubernetes #yaml #template #service #ì‹¤ìŠµ*  
*ğŸ”— ê´€ë ¨: [[K8s_Deep_Dive]] > [[k8sì‹¤ìŠµ]]*  
*ğŸ“… ì‘ì„±ì¼: 2025.11.13*