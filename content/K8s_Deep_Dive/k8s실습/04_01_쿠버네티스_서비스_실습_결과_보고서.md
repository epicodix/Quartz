# ğŸš€ ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ íƒ€ì…ë³„ ì‹¤ìŠµ ê²°ê³¼ ë³´ê³ ì„œ

## ğŸ“‹ ë©”íƒ€ë°ì´í„°

- **ì‹¤ìŠµì¼**: 2025ë…„ 11ì›” 13ì¼
- **í™˜ê²½**: minikube v1.37.0, Kubernetes v1.34.0
- **ì‹¤ìŠµì**: Claude Code
- **ê´€ë ¨ ë¬¸ì„œ**: [[04_00_kubernetes-service-types-guide]]

## ğŸ¯ ì‹¤ìŠµ ê°œìš”

ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ 3ê°€ì§€ í•µì‹¬ ì„œë¹„ìŠ¤ íƒ€ì…(ExternalName, ClusterIP, Headless)ì„ ì‹¤ì œ í™˜ê²½ì—ì„œ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼ë¥¼ ì •ë¦¬

## ğŸŒ 1. ExternalName ì„œë¹„ìŠ¤ ì‹¤ìŠµ ê²°ê³¼

### ğŸ“ êµ¬í˜„ ë‚´ìš©
- **ì„œë¹„ìŠ¤ëª…**: `mysql-external`, `github-api-external`
- **ì™¸ë¶€ ë„ë©”ì¸**: `db.example.com`, `api.github.com`
- **í¬íŠ¸**: 3306, 443

### ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### ì„œë¹„ìŠ¤ ìƒì„± í™•ì¸
```bash
$ kubectl get svc mysql-external
NAME             TYPE           CLUSTER-IP   EXTERNAL-IP      PORT(S)    AGE
mysql-external   ExternalName   <none>       db.example.com   3306/TCP   3s
```

#### DNS í•´ì„ í…ŒìŠ¤íŠ¸ ê²°ê³¼
```bash
$ kubectl exec test-pod -- nslookup github-api-external.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53

github-api-external.default.svc.cluster.local  canonical name = api.github.com
Name:   api.github.com
Address: 20.200.245.245
```

### âœ… ê²€ì¦ ê²°ê³¼
- [x] CNAME ë³„ì¹­ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨
- [x] DNS í•´ì„ì„ í†µí•´ ì™¸ë¶€ IP ë°˜í™˜ í™•ì¸
- [x] ì„œë¹„ìŠ¤ ë‚´ë¶€ì—ì„œ ì™¸ë¶€ ë„ë©”ì¸ì— ì ‘ê·¼ ê°€ëŠ¥

---

## ğŸ  2. ClusterIP ì„œë¹„ìŠ¤ ì‹¤ìŠµ ê²°ê³¼

### ğŸ“ êµ¬í˜„ ë‚´ìš©
- **ë°±ì—”ë“œ íŒŒë“œ**: nginx:alpine Ã— 3ê°œ
- **ì„œë¹„ìŠ¤ëª…**: `backend-service`
- **ì„œë¹„ìŠ¤ í¬íŠ¸**: 8080 â†’ íƒ€ê²Ÿ í¬íŠ¸ 80

### ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### íŒŒë“œ ë° ì„œë¹„ìŠ¤ ìƒíƒœ
```bash
$ kubectl get pods -l app=backend -o wide
NAME                          READY   STATUS    RESTARTS   AGE   IP           NODE
backend-app-f8cf8f9bc-9fwkm   1/1     Running   0          15s   10.244.0.6   minikube
backend-app-f8cf8f9bc-km7bw   1/1     Running   0          15s   10.244.0.4   minikube
backend-app-f8cf8f9bc-llxl4   1/1     Running   0          15s   10.244.0.5   minikube

$ kubectl get svc backend-service
NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
backend-service   ClusterIP   10.100.38.243   <none>        8080/TCP   3s
```

#### ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
```bash
$ kubectl get endpoints backend-service
NAME              ENDPOINTS                                   AGE
backend-service   10.244.0.4:80,10.244.0.5:80,10.244.0.6:80   9s
```

#### ë¡œë“œë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸
```bash
$ kubectl exec test-pod -- sh -c "for i in 1 2 3 4 5; do wget -qO- backend-service:8080 | grep '<h1>'; done"
<h1>Welcome to nginx!</h1>
<h1>Welcome to nginx!</h1>
<h1>Welcome to nginx!</h1>
<h1>Welcome to nginx!</h1>
<h1>Welcome to nginx!</h1>
```

### âœ… ê²€ì¦ ê²°ê³¼
- [x] ClusterIPê°€ ì •ìƒ í• ë‹¹ë¨ (`10.100.38.243`)
- [x] 3ê°œ íŒŒë“œê°€ ì—”ë“œí¬ì¸íŠ¸ì— ë“±ë¡ë¨
- [x] ë‚´ë¶€ ë¡œë“œë°¸ëŸ°ì‹±ì´ ì •ìƒ ì‘ë™
- [x] í¬íŠ¸ í¬ì›Œë”©ìœ¼ë¡œ ì™¸ë¶€ ì ‘ê·¼ í™•ì¸

---

## ğŸ‘» 3. Headless ì„œë¹„ìŠ¤ ì‹¤ìŠµ ê²°ê³¼

### ğŸ“ êµ¬í˜„ ë‚´ìš©
- **StatefulSet**: MongoDB Ã— 3ê°œ (mongodb-0, mongodb-1, mongodb-2)
- **Headless ì„œë¹„ìŠ¤**: `mongodb-headless` (clusterIP: None)
- **ë¹„êµìš© ClusterIP**: `mongodb-clusterip`

### ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### StatefulSet ë° ì„œë¹„ìŠ¤ ìƒíƒœ
```bash
$ kubectl get pods -l app=mongodb -o wide
NAME        READY   STATUS    RESTARTS   AGE   IP            NODE
mongodb-0   1/1     Running   0          40s   10.244.0.8    minikube
mongodb-1   1/1     Running   0          21s   10.244.0.9    minikube
mongodb-2   1/1     Running   0          20s   10.244.0.10   minikube

$ kubectl get svc | grep mongodb
mongodb-clusterip     ClusterIP      10.97.68.182    <none>           27017/TCP   3s
mongodb-headless      ClusterIP      None            <none>           27017/TCP   97s
```

#### DNS í•´ì„ ë¹„êµ í…ŒìŠ¤íŠ¸

**Headless ì„œë¹„ìŠ¤ (ëª¨ë“  íŒŒë“œ IP ë°˜í™˜)**
```bash
$ kubectl exec dns-test -- nslookup mongodb-headless.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53

Name:   mongodb-headless.default.svc.cluster.local
Address: 10.244.0.8
Name:   mongodb-headless.default.svc.cluster.local
Address: 10.244.0.10
Name:   mongodb-headless.default.svc.cluster.local
Address: 10.244.0.9
```

**ClusterIP ì„œë¹„ìŠ¤ (ë‹¨ì¼ ê°€ìƒ IP)**
```bash
$ kubectl exec dns-test -- nslookup mongodb-clusterip.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53

Name:   mongodb-clusterip.default.svc.cluster.local
Address: 10.97.68.182
```

#### ê°œë³„ íŒŒë“œ ì§ì ‘ ì ‘ê·¼
```bash
$ kubectl exec dns-test -- nslookup mongodb-0.mongodb-headless.default.svc.cluster.local
Name:   mongodb-0.mongodb-headless.default.svc.cluster.local
Address: 10.244.0.8

$ kubectl exec dns-test -- nslookup mongodb-1.mongodb-headless.default.svc.cluster.local
Name:   mongodb-1.mongodb-headless.default.svc.cluster.local
Address: 10.244.0.9

$ kubectl exec dns-test -- nslookup mongodb-2.mongodb-headless.default.svc.cluster.local
Name:   mongodb-2.mongodb-headless.default.svc.cluster.local
Address: 10.244.0.10
```

### âœ… ê²€ì¦ ê²°ê³¼
- [x] ClusterIPê°€ Noneìœ¼ë¡œ ì„¤ì •ë¨
- [x] DNS ì¡°íšŒ ì‹œ ëª¨ë“  íŒŒë“œ IP ë°˜í™˜ í™•ì¸
- [x] `pod-name.service-name` í˜•íƒœë¡œ ê°œë³„ ì ‘ê·¼ ê°€ëŠ¥
- [x] StatefulSetê³¼ Headless ì„œë¹„ìŠ¤ ì •ìƒ ì—°ë™

---

## ğŸ“Š ì„œë¹„ìŠ¤ íƒ€ì…ë³„ ë¹„êµ ë¶„ì„

| í•­ëª© | ExternalName | ClusterIP | Headless |
|------|-------------|-----------|----------|
| **ClusterIP í• ë‹¹** | âŒ None | âœ… ê°€ìƒ IP | âŒ None |
| **DNS í•´ì„ ê²°ê³¼** | ì™¸ë¶€ FQDN | ë‹¨ì¼ IP | ëª¨ë“  íŒŒë“œ IP |
| **ë¡œë“œë°¸ëŸ°ì‹±** | âŒ ì—†ìŒ | âœ… kube-proxy | âŒ ì—†ìŒ |
| **ê°œë³„ íŒŒë“œ ì ‘ê·¼** | âŒ ë¶ˆê°€ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ |
| **ì£¼ìš” ìš©ë„** | ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¶”ìƒí™” | ë‚´ë¶€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | StatefulSet, ë¶„ì‚° DB |

## ğŸ” ì£¼ìš” í•™ìŠµ í¬ì¸íŠ¸

### 1. DNS ë™ì‘ ë°©ì‹ì˜ ì°¨ì´
- **ExternalName**: DNS CNAME ë ˆì½”ë“œë¡œ ì™¸ë¶€ ë„ë©”ì¸ ë§¤í•‘
- **ClusterIP**: A ë ˆì½”ë“œë¡œ ë‹¨ì¼ ê°€ìƒ IP ë°˜í™˜ (kube-proxyê°€ ë¡œë“œë°¸ëŸ°ì‹±)
- **Headless**: ì—¬ëŸ¬ A ë ˆì½”ë“œë¡œ ëª¨ë“  íŒŒë“œ IP ì§ì ‘ ë°˜í™˜

### 2. ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ íŒ¨í„´
- **ExternalName**: í™˜ê²½ë³„ ì™¸ë¶€ ì˜ì¡´ì„± ì¶”ìƒí™”
- **ClusterIP**: í‘œì¤€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- **Headless**: ìƒíƒœê°€ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ P2P í†µì‹ 

### 3. StatefulSetê³¼ì˜ ê´€ê³„
- **Headless ì„œë¹„ìŠ¤**: StatefulSetì˜ serviceNameìœ¼ë¡œ ì§€ì •
- **ì•ˆì •ì ì¸ ë„¤íŠ¸ì›Œí¬ ID**: `<pod-name>.<service-name>.<namespace>.svc.cluster.local`
- **ìˆœì„œë³´ì¥**: StatefulSet íŒŒë“œì˜ ìˆœì°¨ì  ìƒì„±/ì‚­ì œ

## ğŸš¨ ì‹¤ìŠµ ì¤‘ ë°œê²¬í•œ ì´ìŠˆ

### 1. DNS ê²€ìƒ‰ ë„ë©”ì¸ ì´ìŠˆ
- **í˜„ìƒ**: ì§§ì€ ì´ë¦„ìœ¼ë¡œ nslookup ì‹œ NXDOMAIN ì˜¤ë¥˜
- **í•´ê²°**: FQDN ì‚¬ìš© (`service.namespace.svc.cluster.local`)
- **ì›ì¸**: CoreDNSì˜ ê²€ìƒ‰ ë„ë©”ì¸ ì„¤ì •

### 2. StatefulSet íŒŒë“œ ìˆœì°¨ ìƒì„±
- **í˜„ìƒ**: íŒŒë“œê°€ í•œ ë²ˆì— ëª¨ë‘ ìƒì„±ë˜ì§€ ì•ŠìŒ
- **ì •ìƒ ë™ì‘**: StatefulSetì€ ìˆœì°¨ì  íŒŒë“œ ìƒì„±ì´ ê¸°ë³¸ ì •ì±…
- **í™•ì¸**: `kubectl get pods --watch`ë¡œ ìƒì„± ê³¼ì • ê´€ì°°

## ğŸ› ï¸ ì‹¤ìŠµ í™˜ê²½ ì •ë³´

```yaml
# í´ëŸ¬ìŠ¤í„° ì •ë³´
Kubernetes: v1.34.0
Platform: minikube v1.37.0
Driver: qemu2
OS: macOS Darwin 24.6.0 (ARM64)
CNI: bridge
DNS: CoreDNS (10.96.0.10)

# ë„¤íŠ¸ì›Œí¬ ì •ë³´
Pod Network: 10.244.0.0/16
Service Network: 10.96.0.0/12
Node IP: minikube (single node)
```

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ ë° ì°¸ê³  ìë£Œ

### ë‚´ë¶€ ë§í¬
- [[04_00_kubernetes-service-types-guide]] - ì‹¤ìŠµ ê°€ì´ë“œ ì›ë³¸
- [[Kubernetes (MOC)]] - ì¿ ë²„ë„¤í‹°ìŠ¤ ê°œë… ì§€ë„
- [[K8s - Service]] - ì„œë¹„ìŠ¤ ê°œë… ìƒì„¸
- [[ì›Œì»¤ ë…¸ë“œ (Worker Node)]] - ë…¸ë“œ ì•„í‚¤í…ì²˜

### ì™¸ë¶€ ì°¸ê³  ìë£Œ
- [Kubernetes Service Documentation](https://kubernetes.io/docs/concepts/services-networking/service/)
- [StatefulSet Documentation](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/)
- [DNS for Services and Pods](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/)

## ğŸ¯ ë‹¤ìŒ í•™ìŠµ ë°©í–¥

### ì¦‰ì‹œ ì‹¤ìŠµ ê°€ëŠ¥
- [[LoadBalancerì™€ NodePort ì„œë¹„ìŠ¤ ì‹¤ìŠµ]]
- [[Ingress Controller ì‹¤ìŠµ]]
- [[NetworkPolicy ì‹¤ìŠµ]]

### ì‹¬í™” í•™ìŠµ
- [[Service Mesh (Istio) ì‹¤ìŠµ]]
- [[Multi-cluster Service Discovery]]
- [[ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí‚¹ ì‹¬í™”]]

---

## ğŸ“ ì‹¤ìŠµ í›„ê¸°

### âœ… ì„±ê³¼
1. **ì´ë¡ ê³¼ ì‹¤ì œì˜ ì°¨ì´** ëª…í™•íˆ ì´í•´
2. **DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬** ë©”ì»¤ë‹ˆì¦˜ ì‹¤ì¦
3. **ê° ì„œë¹„ìŠ¤ íƒ€ì…ì˜ ì ì ˆí•œ ì‚¬ìš© ì‚¬ë¡€** íŒŒì•…
4. **íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê²½í—˜** ì¶•ì 

### ğŸ”„ ê°œì„  ì‚¬í•­
1. ë” ë³µì¡í•œ ë„¤íŠ¸ì›Œí¬ ì •ì±…ê³¼ í•¨ê»˜ í…ŒìŠ¤íŠ¸
2. ë©€í‹° ë…¸ë“œ í™˜ê²½ì—ì„œì˜ ë™ì‘ í™•ì¸
3. ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì›Œí¬ë¡œë“œë¡œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

*ğŸ“… ì‘ì„±ì¼: 2025.11.13*  
*ğŸ·ï¸ íƒœê·¸: #kubernetes #service #networking #ì‹¤ìŠµ #dns #statefulset*  
*ğŸ”— ì—°ê²°: [[K8s_Deep_Dive]]ì˜ ì‹¤ìŠµ ì‹œë¦¬ì¦ˆ*