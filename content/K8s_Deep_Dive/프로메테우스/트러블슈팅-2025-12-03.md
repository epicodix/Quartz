---
title: Prometheus ì„¤ì • íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡
date: 2025-12-03
tags: [kubernetes, prometheus, monitoring, troubleshooting, vagrant]
status: âœ… í•´ê²°ì™„ë£Œ
difficulty: â­â­â­
---

# ğŸ”§ Prometheus ì„¤ì • íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡

> **ëª©í‘œ**: Kubernetes í´ëŸ¬ìŠ¤í„°ì— Prometheus ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ êµ¬ì„±
> **í™˜ê²½**: macOS M1 + VMware Fusion + Vagrant
> **ê²°ê³¼**: âœ… ì„±ê³µ (5ê°œ ì´ìŠˆ í•´ê²°)

---

## ğŸ“Š ìš”ì•½ ëŒ€ì‹œë³´ë“œ

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ìµœì´ˆ í™˜ê²½ | âš ï¸ M2 ë…¸íŠ¸ë¶ (8GB) | ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ì‹¤íŒ¨ |
| ë§ˆì´ê·¸ë ˆì´ì…˜ | âš ï¸ M1 ë§¥ë¯¸ë‹ˆ (16GB) | VirtualBox í˜¸í™˜ì„± ì—†ìŒ |
| í•˜ì´í¼ë°”ì´ì € | âœ… VMware Fusion | ARM64 ì•ˆì •, í—¤ë“œë¦¬ìŠ¤ ë¶ˆê°€ |
| í´ëŸ¬ìŠ¤í„° ìƒíƒœ | âœ… ì •ìƒ | 4ë…¸ë“œ (1 CP + 3 Worker) |
| Prometheus | âœ… ì‹¤í–‰ì¤‘ | http://192.168.1.11 |
| Node Exporter | âœ… ì‹¤í–‰ì¤‘ | 3ê°œ Pod (ëª¨ë“  ë…¸ë“œ) |
| Kube State Metrics | âœ… ì‹¤í–‰ì¤‘ | ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì •ìƒ |
| LoadBalancer | âœ… ì •ìƒ | MetalLB (192.168.1.11-13) |

---

## ğŸ”´ Issue #0: M2 ë©”ëª¨ë¦¬ ë¶€ì¡± â†’ M1 ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚½ì§ˆê¸° ğŸ’€

### ğŸ’¥ ê·¼ë³¸ ë¬¸ì œ: ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# M2 ë…¸íŠ¸ë¶ì—ì„œ ì‹¤ìŠµ ì‹œì‘
vagrant up --provider=virtualbox
# 4ëŒ€ VM êµ¬ë™: CP(2GB) + Worker(2GB Ã— 3) = 8GB
# â†’ ì‹œìŠ¤í…œ ì „ì²´ ë©”ëª¨ë¦¬ ë¶€ì¡±!
# â†’ VM ëŠê¹€, ëŠë ¤ì§, ë¶ˆì•ˆì •
```

**ì¦ìƒ**:
- Kubernetes Podë“¤ì´ ë¬´ì‘ìœ„ë¡œ ì¬ì‹œì‘
- `kubectl` ëª…ë ¹ì–´ ì‘ë‹µ ì§€ì—°
- VM ì „ì²´ê°€ ë©ˆì¶”ëŠ” í˜„ìƒ ë°˜ë³µ

### ğŸ¤” í•´ê²° ì‹œë„: M1 ë§¥ë¯¸ë‹ˆë¡œ ì´ì£¼ (16GB RAM)

> **ì•„ì´ë””ì–´**: M2 ë…¸íŠ¸ë¶(8GB?) â†’ M1 ë§¥ë¯¸ë‹ˆ(16GB)ë¡œ ì˜®ê¸°ë©´ í•´ê²°!

```bash
# M1 ë§¥ë¯¸ë‹ˆì—ì„œ ë™ì¼í•œ VirtualBox ì‹¤í–‰ ì‹œë„
cd /Users/irix/epix/_Lecture_prom_learning.kit-main/ch2/2.4
vagrant up --provider=virtualbox

# âŒ ì‹¤íŒ¨!
# Error: VirtualBox on ARM64 compatibility issues
```

### ğŸ”„ ARM64 ê°€ìƒí™” í˜¸í™˜ì„± ë””ê¹… ì—¬ì •

| í™˜ê²½ | í•˜ì´í¼ë°”ì´ì € | ë©”ëª¨ë¦¬ | í˜¸í™˜ì„± | í—¤ë“œë¦¬ìŠ¤ | ê²°ê³¼ |
|------|------------|--------|--------|---------|------|
| **M2 ë…¸íŠ¸ë¶** | VirtualBox | 8GB? | âœ… | âœ… | âš ï¸ ë©”ëª¨ë¦¬ ë¶€ì¡± |
| **M1 ë§¥ë¯¸ë‹ˆ** | VirtualBox | 16GB | âŒ | - | ARM64 ì´ìŠˆ |
| **M1 ë§¥ë¯¸ë‹ˆ** | VMware Fusion | 16GB | âœ… | âŒ | âœ… ìµœì¢… ì„ íƒ |

### ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

#### 1. ARM64 ê°€ìƒí™”ì˜ í˜„ì‹¤
```
ARM64 (Apple Silicon) ê°€ìƒí™” ìŠ¤íƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ macOS (ARM64)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hypervisor Framework                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VirtualBox / VMware / Parallels     â”‚ â† í˜¸í™˜ì„± ì°¨ì´!
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Guest OS (Ubuntu ARM64)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VirtualBoxì˜ ARM64 ì§€ì› ìƒí™©**:
- **M1 (2020-2021)**: ë² íƒ€ ìˆ˜ì¤€, ë¶ˆì•ˆì • ğŸ˜°
- **M2 (2022+)**: ì ì§„ì  ê°œì„ , ì—¬ì „íˆ ë²„ê·¸ ìˆìŒ âš ï¸
- **M3 (2023+)**: ì•ˆì •í™” ë‹¨ê³„ âœ…

#### 2. ë©”ëª¨ë¦¬ ì••ë°• ë¬¸ì œ
```bash
# M2 ë…¸íŠ¸ë¶ ë©”ëª¨ë¦¬ ìƒí™© (ì¶”ì •)
Total: 8GB
  - macOS System: ~3GB
  - Chrome/Apps: ~2GB
  - Available: ~3GB

# Kubernetes í´ëŸ¬ìŠ¤í„° ìš”êµ¬ì‚¬í•­
  - CP: 2GB
  - Worker Ã— 3: 6GB
  - Total: 8GB (ì˜¤ë²„!)
```

#### 3. VMware Fusionì˜ íŠ¸ë ˆì´ë“œì˜¤í”„
âœ… **ì¥ì **:
- M1 ARM64 ë„¤ì´í‹°ë¸Œ ì§€ì›
- ì•ˆì •ì ì¸ ë©”ëª¨ë¦¬ ê´€ë¦¬
- 16GB ì¶©ë¶„íˆ í™œìš© ê°€ëŠ¥

âŒ **ë‹¨ì **:
- í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ ë¶ˆê°€ (GUI í•„ìˆ˜)
- ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì œí•œ

### âœ… ìµœì¢… ê²°ì •: M1 ë§¥ë¯¸ë‹ˆ + VMware Fusion

```bash
# M1 ë§¥ë¯¸ë‹ˆì—ì„œ VMware Fusion ì‚¬ìš©
cd /Users/irix/epix/_Lecture_prom_learning.kit-main/ch2/2.4
vagrant up --provider=vmware_desktop

# âœ… ì„±ê³µ!
# - 16GB ë©”ëª¨ë¦¬ë¡œ 4ëŒ€ VM ì•ˆì •ì  êµ¬ë™
# - ARM64 ë„¤ì´í‹°ë¸Œ ì§€ì›
# - ë©”ëª¨ë¦¬ ìŠ¤ì™‘ ì—†ì´ ì¾Œì í•˜ê²Œ ì‘ë™
```

> **í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ ì‹œë„ ë° ì‹¤íŒ¨**
> ```ruby
> # Vagrantfileì—ì„œ ì‹œë„
> config.vm.provider "vmware_desktop" do |v|
>   v.gui = false
>   v.vmx["headless"] = "TRUE"
> end
> ```
>
> **ê²°ê³¼**: âŒ ëª¨ë‘ ë¬´ì‹œë¨
> - VMware Fusion on ARM64ëŠ” í—¤ë“œë¦¬ìŠ¤ ì‹œë„ëŠ” í˜„ìƒí™©ì—ì„œ ì‹¤íŒ¨
> - GUI ì°½ 4ê°œê°€ í•­ìƒ í™”ë©´ì— í‘œì‹œë¨ (ìµœì†Œí™” í•´ë‘ê³  ì‚¬ìš©í•˜ê¸° )
> - ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ë¶ˆê°€ëŠ¥

### ğŸ’¡ êµí›ˆ: ARM64 ê°€ìƒí™”ì˜ ê³ ì§ˆì  ë¬¸ì œë“¤

#### 1. ë©”ëª¨ë¦¬ ê³„íšì˜ ì¤‘ìš”ì„±
```
ì‹¤ìŠµ í™˜ê²½ ë©”ëª¨ë¦¬ ê³„ì‚°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kubernetes í´ëŸ¬ìŠ¤í„° (ìµœì†Œ)           â”‚
â”‚ - Control Plane: 2GB                 â”‚
â”‚ - Worker Node Ã— 3: 2GB Ã— 3 = 6GB    â”‚
â”‚ - Total VM: 8GB                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í˜¸ìŠ¤íŠ¸ OS ì˜¤ë²„í—¤ë“œ                   â”‚
â”‚ - macOS: 3GB                         â”‚
â”‚ - ì•±ë“¤: 2GB                          â”‚
â”‚ - Buffer: 1GB                        â”‚
â”‚ - Total Host: 6GB                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê¶Œì¥ ë©”ëª¨ë¦¬: 14GB ì´ìƒ               â”‚
â”‚ ì•ˆì „í•œ ë©”ëª¨ë¦¬: 16GB ì´ìƒ â­          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê²°ë¡ **: 8GB ë…¸íŠ¸ë¶ìœ¼ë¡œëŠ” 4-node í´ëŸ¬ìŠ¤í„° ë¶ˆê°€ëŠ¥!

#### 2. ARM64 í•˜ì´í¼ë°”ì´ì € í˜¸í™˜ì„± ë§¤íŠ¸ë¦­ìŠ¤

| í•˜ì´í¼ë°”ì´ì € | M1 (2020) | M2 (2022) | M3 (2023) | í—¤ë“œë¦¬ìŠ¤ | ë¹„ìš© |
|-------------|----------|----------|----------|---------|------|
| **VirtualBox** | âŒ ë¶ˆì•ˆì • | âš ï¸ ê°œì„ ì¤‘ | âœ… ì•ˆì • | âœ… | ë¬´ë£Œ |
| **VMware Fusion** | âœ… ì•ˆì • | âœ… ì•ˆì • | âœ… ì•ˆì • | âŒ | ë¬´ë£Œ |
| **Parallels Desktop** | âœ… ìµœìƒ | âœ… ìµœìƒ | âœ… ìµœìƒ | âœ… | ìœ ë£Œ |
| **UTM** | âš ï¸ ëŠë¦¼ | âš ï¸ ëŠë¦¼ | âš ï¸ ëŠë¦¼ | âœ… | ë¬´ë£Œ |

**í•µì‹¬ ì¸ì‚¬ì´íŠ¸**:
- ARM64 ê°€ìƒí™”ëŠ” ì—¬ì „íˆ ë°œì „ì¤‘ì¸ ê¸°ìˆ 
- ì¹©ì…‹ ì„¸ëŒ€ë³„ë¡œ í˜¸í™˜ì„±ì´ í¬ê²Œ ë‹¤ë¦„
- "ë¬´ë£Œ + ì•ˆì • + í—¤ë“œë¦¬ìŠ¤" ì¡°í•©ì€ ì•„ì§ ì—†ìŒ

#### 3. ì‹¤ì „ ê°€ìƒí™” í™˜ê²½ ì„ íƒ ê¸°ì¤€

```
ë‚˜ì˜ ìƒí™© â†’ ìµœì  ì„ íƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ M1/M2 + ë©”ëª¨ë¦¬ 8GB                      â”‚
â”‚ â†’ í´ëŸ¬ìŠ¤í„° ì¶•ì†Œ (1 CP + 1 Worker)       â”‚
â”‚   ë˜ëŠ” í´ë¼ìš°ë“œ ì‚¬ìš© (GKE, EKS)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ M1 + ë©”ëª¨ë¦¬ 16GB + ì•ˆì •ì„± ìš°ì„           â”‚
â”‚ â†’ VMware Fusion (GUI ê°ìˆ˜) â­           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ M2/M3 + ë©”ëª¨ë¦¬ 16GB + í—¤ë“œë¦¬ìŠ¤ í•„ìˆ˜     â”‚
â”‚ â†’ VirtualBox (ì•ˆì •í™” í™•ì¸ í›„)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì˜ˆì‚° ìˆìŒ + ìµœê³  ì„±ëŠ¥                   â”‚
â”‚ â†’ Parallels Desktop Pro                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í”„ë¡œë•ì…˜ í•™ìŠµ                           â”‚
â”‚ â†’ í´ë¼ìš°ë“œ (ì‹¤ì œ í™˜ê²½ê³¼ ë™ì¼)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. ì´ ì‚½ì§ˆì—ì„œ ì–»ì€ ê²ƒ

**ê¸°ìˆ ì  ì´í•´**:
- ARM64 ì•„í‚¤í…ì²˜ì˜ ê°€ìƒí™” ì œì•½ì‚¬í•­
- í•˜ì´í¼ë°”ì´ì €ë³„ ì„±ìˆ™ë„ ì°¨ì´
- ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ ê³„ì‚° ë°©ë²•

**ì‹¤ë¬´ êµí›ˆ**:
- ë¡œì»¬ ê°œë°œ í™˜ê²½ì˜ í•œê³„ ì¸ì‹
- í´ë¼ìš°ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì  íŒë‹¨
- í•˜ë“œì›¨ì–´ íˆ¬ì vs í´ë¼ìš°ë“œ ë¹„ìš© íŠ¸ë ˆì´ë“œì˜¤í”„

---

## ğŸ”´ Issue #1: OrbStack ì„¤ì¹˜ ì‹¤íŒ¨

### ğŸ’¥ ë¬¸ì œ ìƒí™©
```bash
brew install orbstack
# Error: This software does not run on macOS versions older than Sonoma.
```

### ğŸ” ì›ì¸
- í˜„ì¬ macOS ë²„ì „ì´ Sonoma ë¯¸ë§Œ
- OrbStackì€ macOS Sonoma ì´ìƒë§Œ ì§€ì›

### âœ… í•´ê²°ì±…
```bash
# Vagrant + VMware Fusion ì¡°í•©ìœ¼ë¡œ ëŒ€ì²´
cd /Users/irix/epix/_Lecture_prom_learning.kit-main/ch2/2.4
vagrant up
```

**êµí›ˆ**: ìµœì‹  ë„êµ¬ì˜ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­ì„ í•­ìƒ ë¨¼ì € í™•ì¸í•˜ê¸°

---

## ğŸ”´ Issue #2: Vagrant VM ì‹œì‘ ì‹¤íŒ¨ âš ï¸

### ğŸ’¥ ë¬¸ì œ ìƒí™©
```bash
vagrant reload
# Error: The operation was canceled
# Command: ["-T", "fusion", "start", "...", "nogui"]
```

### ğŸ”„ ì‹œë„í•œ ë°©ë²•ë“¤

| ì‹œë„ | ëª…ë ¹ì–´ | ê²°ê³¼ |
|------|--------|------|
| 1ï¸âƒ£ | `vagrant reload` | âŒ VMware vmrun ì—ëŸ¬ |
| 2ï¸âƒ£ | `vagrant halt && vagrant up` | âŒ ë™ì¼ ì—ëŸ¬ |
| 3ï¸âƒ£ | `vagrant destroy -f && vagrant up` | âœ… ì„±ê³µ |

### ğŸ” ê·¼ë³¸ ì›ì¸
- VMware Fusionì˜ VM ìƒíƒœ ì ê¸ˆ ë¬¸ì œ
- ë„¤íŠ¸ì›Œí¬ ì–´ëŒ‘í„° ì´ˆê¸°í™” ì‹¤íŒ¨
- ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ì˜ íŒŒì¼ í•¸ë“¤ ë¯¸í•´ì œ

### âœ… ìµœì¢… í•´ê²°ì±…

```bash
# ì™„ì „ ì´ˆê¸°í™” í›„ ì¬ìƒì„±
vagrant destroy -f
vagrant up

# VM ìƒíƒœ í™•ì¸
vagrant status
```

> **ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤**  
> VM ìƒíƒœ ì´ìŠˆ ë°œìƒ ì‹œ:
> 1. `vagrant halt` â†’ `vagrant up` (ì†Œí”„íŠ¸ ë¦¬ì…‹)
> 2. `vagrant reload` (VM ì¬ì‹œì‘)
> 3. `vagrant destroy -f` â†’ `vagrant up` (ì™„ì „ ì¬ìƒì„±) â­ ê°€ì¥ í™•ì‹¤

---

## ğŸ”´ Issue #3: Helm ëª…ë ¹ì–´ Zsh íŒŒì‹± ì—ëŸ¬

### ğŸ’¥ ë¬¸ì œ ìƒí™©
```bash
helm install prometheus edu/prometheus \
  --set nodeExporter.tolerations[0].key="node-role.kubernetes.io/master"

# zsh: no matches found: nodeExporter.tolerations[0].key=...
```

### ğŸ” ì›ì¸
- Zshì—ì„œ `[]` ë¬¸ìë¥¼ **ê¸€ë¡œë¹™ íŒ¨í„´**ìœ¼ë¡œ í•´ì„
- Bashì™€ ë‹¤ë¥¸ íŒŒì‹± ë™ì‘

### âœ… í•´ê²°ì±…

```bash
# ë°©ë²• 1: ë°±ìŠ¬ë˜ì‹œ ì´ìŠ¤ì¼€ì´í”„
--set nodeExporter.tolerations\[0\].key="node-role.kubernetes.io/master"

# ë°©ë²• 2: ì‘ì€ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸° (ì¶”ì²œ)
--set 'nodeExporter.tolerations[0].key=node-role.kubernetes.io/master'

# ë°©ë²• 3: values.yaml íŒŒì¼ ì‚¬ìš©
cat > values.yaml << 'YAML'
nodeExporter:
  tolerations:
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
      operator: Exists
YAML

helm install prometheus edu/prometheus -f values.yaml
```

> **Zsh vs Bash**  
> - Zsh: `[]` â†’ ê¸€ë¡œë¹™ íŒ¨í„´ (ì—ëŸ¬ ë°œìƒ)
> - Bash: `[]` â†’ ì¼ë°˜ ë¬¸ì (ì •ìƒ ë™ì‘)
> 
> **í•´ê²°**: í•­ìƒ ë”°ì˜´í‘œ ì‚¬ìš©í•˜ê¸°!

---

## ğŸ”´ Issue #4: kubectl ì ‘ê·¼ ë¶ˆê°€ (kubeconfig ë¯¸ì„¤ì •) â­

### ğŸ’¥ ë¬¸ì œ ìƒí™©
```bash
kubectl get po,svc -n monitoring

# The connection to the server localhost:8080 was refused
# E1203 23:49:24.398515 memcache.go:265 "Unhandled Error"
# err="couldn't get current server API group list:
# Get \"http://localhost:8080/api?timeout=32s\":
# dial tcp [::1]:8080: connect: connection refused"
```

### ğŸ” ì§„ë‹¨ ê³¼ì •

```bash
# 1. kubeconfig íŒŒì¼ í™•ì¸ ì‹œë„
cat ~/.kube/config
# cat: /Users/irix/.kube/config: No such file or directory

# 2. ë””ë ‰í† ë¦¬ ì¡´ì¬ í™•ì¸
ls -la ~/.kube
# ls: /Users/irix/.kube: No such file or directory
```

**ê·¼ë³¸ ì›ì¸**: `~/.kube` ë””ë ‰í† ë¦¬ ìì²´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ!

### âœ… ì™„ë²½í•œ í•´ê²° ê³¼ì •

```bash
# Step 1: .kube ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p ~/.kube

# Step 2: Control Planeì—ì„œ admin.conf ê°€ì ¸ì˜¤ê¸°
vagrant ssh cp-k8s-1.30.3 -c "sudo cat /etc/kubernetes/admin.conf" > ~/.kube/config

# Step 3: íŒŒì¼ ê¶Œí•œ ì„¤ì • (ë³´ì•ˆ)
chmod 600 ~/.kube/config

# Step 4: ì ‘ì† í…ŒìŠ¤íŠ¸
kubectl cluster-info
kubectl get nodes
kubectl get po,svc -n monitoring
```

### âœ… ê²€ì¦ ê²°ê³¼

```bash
NAME                                                 READY   STATUS    RESTARTS   AGE
pod/prometheus-kube-state-metrics-67b6f4659b-zltbm   1/1     Running   0          10m
pod/prometheus-node-exporter-6c55d                   1/1     Running   0          10m
pod/prometheus-node-exporter-kdhnn                   1/1     Running   0          10m
pod/prometheus-node-exporter-m9d7m                   1/1     Running   0          10m
pod/prometheus-server-549cf9857b-vgqrt               2/2     Running   0          10m

NAME                                    TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)        AGE
service/prometheus-kube-state-metrics   ClusterIP      10.101.181.165   <none>         8080/TCP       10m
service/prometheus-node-exporter        ClusterIP      None             <none>         9100/TCP       10m
service/prometheus-server               LoadBalancer   10.107.76.65     192.168.1.11   80:31160/TCP   10m
```

> **ì„±ê³µ ì§€í‘œ**
> - âœ… ëª¨ë“  Podê°€ `Running` ìƒíƒœ
> - âœ… Prometheus Serverê°€ LoadBalancerë¡œ ë…¸ì¶œ
> - âœ… External IP í• ë‹¹ë¨: `192.168.1.11`
> - âœ… ë¸Œë¼ìš°ì € ì ‘ì† ê°€ëŠ¥: http://192.168.1.11

---

## ğŸ“Š ìµœì¢… ì¸í”„ë¼ êµ¬ì„±

### ğŸ–¥ï¸ í´ëŸ¬ìŠ¤í„° ì •ë³´

```yaml
Cluster Name: k8s-1.30.3
Kubernetes Version: v1.30.3

Nodes:
  Control Plane:
    - Hostname: cp-k8s-1.30.3
    - IP: 192.168.1.10
    - Role: master

  Workers:
    - Hostname: w1-k8s-1.30.3
      IP: 192.168.1.11
      Role: worker

    - Hostname: w2-k8s-1.30.3
      IP: 192.168.1.12
      Role: worker

    - Hostname: w3-k8s-1.30.3
      IP: 192.168.1.13
      Role: worker
```

### ğŸ”§ ì„¤ì¹˜ëœ ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | ë²„ì „ | ìš©ë„ |
|----------|------|------|
| **Calico** | v3.28 | CNI (ë„¤íŠ¸ì›Œí¬) |
| **MetalLB** | v0.14 | LoadBalancer |
| **NGINX Ingress** | v1.11 | Ingress Controller |
| **Metrics Server** | v0.7 | ë¦¬ì†ŒìŠ¤ ë©”íŠ¸ë¦­ |
| **NFS Provisioner** | v4.0 | ë™ì  ë³¼ë¥¨ í”„ë¡œë¹„ì €ë‹ |

### ğŸ“ˆ Prometheus ìŠ¤íƒ

```yaml
Prometheus Server:
  Type: LoadBalancer
  External IP: 192.168.1.11
  Port: 80 â†’ 9090

Node Exporter:
  Type: DaemonSet
  Pods: 3 (ëª¨ë“  Worker ë…¸ë“œ)
  Metrics: ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

Kube State Metrics:
  Type: Deployment
  Purpose: Kubernetes ë¦¬ì†ŒìŠ¤ ìƒíƒœ ë©”íŠ¸ë¦­

Configuration:
  scrape_interval: 15s
  evaluation_interval: 15s
  pushgateway: disabled
  alertmanager: disabled
```

---

## ğŸ’¡ í•™ìŠµí•œ êµí›ˆ

### 0ï¸âƒ£ ë©”ëª¨ë¦¬ ë¶€ì¡± â†’ í•˜ë“œì›¨ì–´ ë§ˆì´ê·¸ë ˆì´ì…˜ì˜ í•¨ì • ğŸ

**ì‚½ì§ˆì˜ ì „ì²´ íë¦„**:
1. M2 ë…¸íŠ¸ë¶(8GB)ì—ì„œ ì‹œì‘ â†’ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ VM ëŠê¹€
2. M1 ë§¥ë¯¸ë‹ˆ(16GB)ë¡œ ì´ë™ ì‹œë„ â†’ VirtualBox ARM64 í˜¸í™˜ì„± ë¬¸ì œ
3. VMware Fusionìœ¼ë¡œ í•´ê²° â†’ í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ ë¶ˆê°€ ë°œê²¬
4. GUI 4ê°œ ì°½ ê°ìˆ˜í•˜ê³  ì§„í–‰ â†’ ìµœì¢… ì„±ê³µ

**í•µì‹¬ êµí›ˆ**:
```
í•˜ë“œì›¨ì–´ ë¬¸ì œ í•´ê²° ì‹œ ê³ ë ¤ì‚¬í•­:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ë©”ëª¨ë¦¬ëŠ” í•­ìƒ ì—¬ìœ ìˆê²Œ (ìµœì†Œ 2ë°°)   â”‚
â”‚ 2. ARM64ëŠ” ì•„ì§ x86_64ë§Œí¼ ì„±ìˆ™ ì•ˆ ë¨  â”‚
â”‚ 3. í•˜ì´í¼ë°”ì´ì € í˜¸í™˜ì„±ì€ ì¹©ì…‹ë§ˆë‹¤ ë‹¤ë¦„ â”‚
â”‚ 4. í—¤ë“œë¦¬ìŠ¤ëŠ” í•„ìˆ˜ê°€ ì•„ë‹ˆë©´ í¬ê¸° ê³ ë ¤  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ARM64 ê°€ìƒí™”ì˜ í˜„ì‹¤**:
- M1 (2020): VirtualBox ë¶ˆì•ˆì •, VMware ì•ˆì •
- M2 (2022): VirtualBox ê°œì„ ì¤‘, VMware ì•ˆì •
- M3 (2023): VirtualBox ì•ˆì •í™” ì‹œì‘
- **ê²°ë¡ **: ë¬´ë£Œë¡œ ì•ˆì •ì ì¸ í—¤ë“œë¦¬ìŠ¤ í™˜ê²½ì€ ì•„ì§ ì—†ìŒ!

### 1ï¸âƒ£ Vagrant VM ê´€ë¦¬ ì „ëµ

**í•µì‹¬ ì›ì¹™**:
- ğŸ”„ `vagrant reload`: ì„¤ì • ë³€ê²½ ì‹œ
- ğŸ”„ `vagrant halt` â†’ `vagrant up`: ì¼ë°˜ì ì¸ ì¬ì‹œì‘
- ğŸ’¥ `vagrant destroy -f` â†’ `vagrant up`: ìƒíƒœ ë¶ˆì¼ì¹˜ ë°œìƒ ì‹œ (ê°€ì¥ í™•ì‹¤)

### 2ï¸âƒ£ Zsh í™˜ê²½ì—ì„œì˜ ì•ˆì „í•œ ëª…ë ¹ì–´ ì‘ì„±

```bash
# âŒ ìœ„í—˜: ëŒ€ê´„í˜¸ê°€ ê¸€ë¡œë¹™ íŒ¨í„´ìœ¼ë¡œ í•´ì„
--set array[0].value=something

# âœ… ì•ˆì „: ì‘ì€ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
--set 'array[0].value=something'

# âœ… ì•ˆì „: ë°±ìŠ¬ë˜ì‹œ ì´ìŠ¤ì¼€ì´í”„
--set array\[0\].value=something

# âœ… ê°€ì¥ ì•ˆì „: values íŒŒì¼ ì‚¬ìš©
helm install -f values.yaml
```

### 3ï¸âƒ£ kubectl ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# 1. kubeconfig íŒŒì¼ ì¡´ì¬ í™•ì¸
ls -la ~/.kube/config

# 2. ë‚´ìš© í™•ì¸
kubectl config view

# 3. í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ í™•ì¸
kubectl config current-context

# 4. í´ëŸ¬ìŠ¤í„° ì—°ê²° í…ŒìŠ¤íŠ¸
kubectl cluster-info

# 5. API ì„œë²„ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
kubectl get nodes
```

> **ì¹˜ëª…ì  ì‹¤ìˆ˜ ë°©ì§€**  
> **localhost:8080 ì—ëŸ¬** = kubeconfig ë¯¸ì„¤ì •!
>
> í•´ê²°:
> ```bash
> mkdir -p ~/.kube
> vagrant ssh cp-k8s -c "sudo cat /etc/kubernetes/admin.conf" > ~/.kube/config
> chmod 600 ~/.kube/config
> ```

---

## ğŸ” ìœ ìš©í•œ ë””ë²„ê¹… ëª…ë ¹ì–´

### Prometheus ìƒíƒœ í™•ì¸

```bash
# ì „ì²´ ë¦¬ì†ŒìŠ¤ í™•ì¸
kubectl get all -n monitoring

# Prometheus Server ë¡œê·¸
kubectl logs -n monitoring deployment/prometheus-server -c prometheus-server

# Node Exporter ë¡œê·¸ (íŠ¹ì • ë…¸ë“œ)
kubectl logs -n monitoring daemonset/prometheus-node-exporter

# ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
kubectl get endpoints -n monitoring

# Prometheus ConfigMap í™•ì¸
kubectl get cm -n monitoring prometheus-server -o yaml
```

### ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…

```bash
# LoadBalancer IP í™•ì¸
kubectl get svc -n monitoring prometheus-server

# MetalLB ìƒíƒœ í™•ì¸
kubectl get ipaddresspool -n metallb-system
kubectl logs -n metallb-system deployment/controller

# ì§ì ‘ curl í…ŒìŠ¤íŠ¸
curl http://192.168.1.11/api/v1/status/config

# í¬íŠ¸ í¬ì›Œë”©ìœ¼ë¡œ ë¡œì»¬ ì ‘ì†
kubectl port-forward -n monitoring svc/prometheus-server 9090:80
# ì ‘ì†: http://localhost:9090
```

### VM ìƒíƒœ í™•ì¸

```bash
# Vagrant ì „ì²´ ìƒíƒœ
vagrant status

# íŠ¹ì • VM SSH ì ‘ì†
vagrant ssh cp-k8s-1.30.3

# VM ë‚´ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
vagrant ssh cp-k8s-1.30.3 -c "kubectl get nodes"

# ë„¤íŠ¸ì›Œí¬ í™•ì¸
vagrant ssh cp-k8s-1.30.3 -c "ip addr show"
```

---

## ğŸ“Œ ë‹¤ìŒ ë‹¨ê³„ (TODO)

- [ ] **Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì„±**
  - Prometheus ë°ì´í„°ì†ŒìŠ¤ ì—°ê²°
  - Kubernetes í´ëŸ¬ìŠ¤í„° ëŒ€ì‹œë³´ë“œ ì„í¬íŠ¸
  - Node Exporter ëŒ€ì‹œë³´ë“œ ì„¤ì •

- [ ] **AlertManager ì„¤ì •**
  - ì•Œë¦¼ ê·œì¹™ ì‘ì„±
  - Slack/Email í†µí•©
  - ì•Œë¦¼ ë¼ìš°íŒ… êµ¬ì„±

- [ ] **Custom Metrics ì¶”ê°€**
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
  - ServiceMonitor ë¦¬ì†ŒìŠ¤ ìƒì„±
  - ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ ì‘ì„±

- [ ] **Prometheus Rules ì‘ì„±**
  - Recording Rules (ì§‘ê³„)
  - Alerting Rules (ê²½ê³ )

- [ ] **ì¥ê¸° ìŠ¤í† ë¦¬ì§€ ê³ ë ¤**
  - Thanos ë˜ëŠ” Cortex ê²€í† 
  - S3 ë°±ì—”ë“œ êµ¬ì„±

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

### ë‚´ë¶€ ë§í¬
- [[kubernetes_cheatsheet]]
- [[kubernetes_storage_hands_on]]
- [[MetalLB_ì‰½ê²Œ_ì´í•´í•˜ê¸°]]
- [[Helm_í•µì‹¬_ëª…ë ¹ì–´_ì™„ë²½_ì •ë¦¬]]

### ì™¸ë¶€ ì°¸ê³  ìë£Œ
- [Prometheus ê³µì‹ ë¬¸ì„œ](https://prometheus.io/docs/)
- [Helm Chart: kube-prometheus-stack](https://github.com/prometheus-community/helm-charts)
- [MetalLB ì„¤ì • ê°€ì´ë“œ](https://metallb.universe.tf/)
- [Vagrant ê³µì‹ ë¬¸ì„œ](https://www.vagrantup.com/docs)

---

## ğŸ“Š ì‘ì—… í†µê³„

| í•­ëª© | ìˆ˜ì¹˜ |
|------|------|
| ì´ ì†Œìš” ì‹œê°„ | ~4ì‹œê°„ |
| í•´ê²°í•œ ì´ìŠˆ | 5ê°œ (VirtualBox M1 í¬í•¨) |
| ìƒì„±ëœ VM | 4ëŒ€ |
| ë°°í¬ëœ Pod | 5ê°œ |
| ì¬ì‹œì‘ íšŸìˆ˜ | 3íšŒ |
| ì„±ê³µë¥  | 100% âœ… |

---

## ğŸ¯ í•µì‹¬ ìš”ì•½

> **TL;DR: ì§„ì§œ ì‚½ì§ˆì˜ ì—¬ì •**
> 0. âš ï¸ M2 ë…¸íŠ¸ë¶(8GB) ë©”ëª¨ë¦¬ ë¶€ì¡± â†’ VM ëŠê¹€ ë°˜ë³µ
> 1. ğŸ’¡ M1 ë§¥ë¯¸ë‹ˆ(16GB)ë¡œ ì´ë™ ì‹œë„ â†’ ARM64 VirtualBox í˜¸í™˜ì„± ì—†ìŒ
> 2. âœ… VMware Fusion ì„ íƒ â†’ í—¤ë“œë¦¬ìŠ¤ ë¶ˆê°€ ê°ìˆ˜
> 3. âŒ OrbStack ì‹¤íŒ¨ â†’ Vagrantë¡œ ëŒ€ì²´
> 4. âŒ VM ì‹œì‘ ì‹¤íŒ¨ â†’ `vagrant destroy -f` í›„ ì¬ìƒì„±
> 5. âŒ Zsh íŒŒì‹± ì—ëŸ¬ â†’ ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
> 6. âŒ kubeconfig ì—†ìŒ â†’ `mkdir ~/.kube` + admin.conf ë³µì‚¬
>
> **ìµœì¢… ê²°ê³¼**: Prometheus @ http://192.168.1.11 âœ…
>
> **ê°€ì¥ í° êµí›ˆ**:
> - 8GB ë©”ëª¨ë¦¬ë¡œëŠ” 4-node í´ëŸ¬ìŠ¤í„° ë¶ˆê°€ëŠ¥
> - ARM64 ê°€ìƒí™”ëŠ” ì•„ì§ ë°œì „ì¤‘ (ë¬´ë£Œ í—¤ë“œë¦¬ìŠ¤ ì—†ìŒ)
> - í•˜ë“œì›¨ì–´ ì œì•½ì€ í´ë¼ìš°ë“œë¡œ í•´ê²° ê³ ë ¤

---

**ì‘ì„±ì**: irix  
**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-03 23:55:00 KST  
**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ  
**ë‚œì´ë„**: â­â­â­ (ì¤‘)

---

#kubernetes #prometheus #troubleshooting #vagrant #devops #monitoring
