---
creation_date: 2025-11-05
---

# 쿠버네티스 네트워킹 핵심 개념 정리

> 이 문서는 쿠버네티스 클러스터 내에서 파드(Pod)와 서비스(Service)들이 어떻게 서로 통신하고 외부 세계와 연결되는지에 대한 핵심 원리를 설명합니다. 가상머신(VM)과 컨테이너의 차이부터 시작하여, CNI, 서비스, DNS, 네트워크 정책에 이르기까지의 전체 흐름을 다룹니다.

---

## 1. 쿠버네티스의 3가지 핵심 네트워크 요구사항

쿠버네티스는 CNI라는 플러그인 방식을 통해 네트워킹 구현의 자율성을 부여하지만, 어떤 CNI를 사용하든 반드시 지켜야 할 3가지 기본 원칙을 제시합니다. 이 원칙 덕분에 개발자는 복잡한 네트워크 설정을 신경 쓰지 않아도 됩니다.

### 1.1. 모든 파드는 고유한 IP를 가진다

- **전통적 Docker 방식의 문제점:** 컨테이너는 호스트(Node)의 IP를 공유하고 포트 포워딩(`-p 8080:80`)을 사용했습니다. 이로 인해 개발자는 항상 포트 충돌을 관리해야 하는 불편함이 있었습니다.
- **쿠버네티스 해결책:** 모든 파드에 **독립적이고 고유한 IP 주소**를 할당합니다. 마치 작은 VM처럼 동작하여, 모든 파드가 자신만의 80번, 443번 포트를 가질 수 있습니다. CNI 플러그인이 이 역할을 수행합니다.

### 1.2. 모든 파드는 NAT 없이 서로 통신한다

- **NAT(Network Address Translation)란?** 내부 IP 주소를 외부 IP 주소로 변환하여, 실제 출발지 IP를 숨기는 기술입니다. (예: 집 공유기)
- **NAT의 문제점:** NAT를 거치면 패킷의 출발지 IP가 파드의 IP가 아닌 노드의 IP로 변경됩니다. 이렇게 되면 어떤 파드가 요청을 보냈는지 알 수 없어 보안 정책 적용이나 디버깅이 매우 어려워집니다.
- **쿠버네티스 해결책:** 파드 간 통신 시, 출발지 파드의 IP가 목적지 파드에 그대로 보여야 합니다. 이를 통해 투명한 통신이 가능해집니다.
    - **같은 노드 내 통신:** 가상 브릿지(`cni0`)를 통해 매우 빠르게 통신합니다. (L2 통신)
    - **다른 노드 간 통신:** CNI 플러그인이 라우팅을 책임집니다. (L3 통신)
        - **Overlay 방식 (Flannel):** 원본 패킷을 다른 패킷으로 감싸서(캡슐화) 터널을 통해 전달합니다. 설정은 쉽지만 약간의 성능 저하가 있습니다.
        - **Direct Routing 방식 (Calico):** 각 노드가 라우터처럼 동작하여, "이 IP 대역은 나에게 보내!"라고 서로 광고(BGP)합니다. 캡슐화가 없어 성능이 뛰어납니다.

### 1.3. 노드와 파드는 NAT 없이 서로 통신한다

- **필요성:** 노드에서 실행되는 관리 프로세스(예: `kubelet`)가 파드의 상태를 확인(`health check`)하거나, 파드에서 실행되는 모니터링 에이전트가 노드의 정보를 수집해야 할 때가 있습니다.
- **쿠버네티스 해결책:** 이 통신 역시 NAT 없이 양방향으로 실제 IP를 사용하여 투명하게 이루어져야 합니다.

---

## 2. 쿠버네티스의 4가지 IP 주소

쿠버네티스 생태계에는 목적에 따라 4가지 종류의 IP가 존재합니다.

| 종류 | 설명 | 특징 |
|---|---|---|
| **Pod IP** | 파드에 할당되는 고유 IP | 클러스터 내부용, 비영속적 (재시작 시 변경) |
| **Node IP** | 노드(VM/물리서버)의 IP | 인프라 레벨 IP, 안정적 |
| **Cluster IP** | 서비스에 할당되는 가상 IP | 클러스터 내부용, 영속적, 로드 밸런싱 역할 |
| **External IP** | 외부에 서비스를 노출하기 위한 공인 IP | 인터넷에서 접근 가능, 클라우드 로드밸런서와 연동 |

**통신 흐름 예시:**

`인터넷 사용자` → `External IP (LoadBalancer Service)` → `Node IP (NodePort)` → `Cluster IP (kube-proxy)` → `Pod IP`

---

## 3. CNI(Container Network Interface) 플러그인

CNI는 쿠버네티스가 네트워크 설정을 직접 하지 않고, 외부 플러그인에게 위임하기 위한 **표준 인터페이스**입니다. Kubelet은 파드 생성 시 CNI 플러그인을 호출하여 네트워크 설정을 맡깁니다.

| 플러그인 | 핵심 기술 | 장점 | 단점 | 추천 용도 |
|---|---|---|---|---|
| **Flannel** | VXLAN 오버레이 | 매우 간단, 기존 네트워크 수정 불필요 | 성능 오버헤드, **네트워크 정책 미지원** | 개발/학습용, 소규모 클러스터 |
| **Calico** | BGP 라우팅 | 고성능, 강력한 네트워크 정책 | BGP 개념 필요, 초기 설정 복잡도 | **프로덕션 표준**, 보안 중요 환경 |
| **Cilium** | eBPF (커널 프로그래밍) | 압도적 성능, L7(API) 수준 보안, 뛰어난 가시성 | 최신 리눅스 커널 필요 | 최고 성능/보안이 필요한 환경 |

---

## 4. 이름으로 통신하기: DNS와 서비스 디스커버리

파드 IP는 언제든 변할 수 있기 때문에, IP 주소로 직접 통신하는 것은 매우 불안정합니다. 쿠버네티스는 **CoreDNS**라는 내부 DNS 서버를 통해 이 문제를 해결합니다.

- **동작 원리:**
    1. `my-svc`라는 이름의 서비스가 생성되면, CoreDNS는 `my-svc`라는 도메인 이름과 해당 서비스의 Cluster IP를 자동으로 매핑합니다.
    2. 다른 파드가 `http://my-svc`로 요청을 보내면, 이 요청은 CoreDNS로 전달됩니다.
    3. CoreDNS는 `my-svc`에 해당하는 Cluster IP (`10.96.x.x`)를 알려줍니다.
    4. `kube-proxy`가 이 Cluster IP로 가는 트래픽을 실제 파드 IP 중 하나로 전달(로드 밸런싱)합니다.

- **위치 투명성 (Location Transparency):** 개발자는 단지 서비스 이름(`user-service`)만 코드에 넣으면, 쿠버네티스가 알아서 해당 서비스에 연결된 파드를 찾아줍니다. 파드가 어느 노드에 있든, IP가 바뀌든 상관없습니다.

---

## 5. 네트워크 보안: 네트워크 정책 (Network Policy)

- **기본 상태의 위험성:** 쿠버네티스는 기본적으로 **'모든 파드는 서로 통신할 수 있다(Default Allow)'**는 정책을 가집니다. 이는 매우 편리하지만, 해커가 하나의 파드를 뚫었을 때 다른 모든 파드로 쉽게 이동(Lateral Movement)할 수 있는 심각한 보안 위협이 됩니다.

- **제로 트러스트 (Zero Trust) 원칙:** "아무도 믿지 말고, 항상 검증하라." 네트워크 정책은 이 원칙을 쿠버네티스에 구현하는 방법입니다. **'기본적으로 모두 차단하고, 명시적으로 허용한 통신만 허용'**하는 화이트리스트 기반의 방화벽을 설정합니다.

- **`NetworkPolicy` 리소스 예시:**

  ```yaml
  apiVersion: networking.k8s.io/v1
  kind: NetworkPolicy
  metadata:
    name: db-allow-backend
  spec:
    podSelector: # 1. 이 정책을 적용할 파드 (예: 데이터베이스 파드)
      matchLabels:
        role: database
    policyTypes:
    - Ingress # 인바운드(들어오는) 트래픽 제어
    ingress:
    - from: # 2. 어디에서 오는 트래픽을 허용할 것인가?
      - podSelector:
          matchLabels:
            app: backend
      ports: # 3. 어떤 포트를 허용할 것인가?
      - protocol: TCP
        port: 6379
  ```
  > **해석:** `role=database` 레이블을 가진 파드는, `app=backend` 레이블을 가진 파드로부터 오는 6379번 TCP 포트 트래픽만 허용한다. 그 외의 모든 인바운드 트래픽은 차단된다.

- **핵심:** 네트워크 정책은 CNI 플러그인(Calico, Cilium 등)에 의해 실제로 구현됩니다. Flannel은 이 기능을 지원하지 않습니다.
